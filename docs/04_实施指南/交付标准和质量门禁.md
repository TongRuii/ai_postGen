# æ™ºç»˜æµ·æŠ¥é¡¹ç›® - äº¤ä»˜æ ‡å‡†å’Œè´¨é‡é—¨ç¦

**ç‰ˆæœ¬**: V1.0
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ26æ—¥
**é€‚ç”¨èŒƒå›´**: MVPé˜¶æ®µ â†’ Phase 3
**æŠ€æœ¯æ ˆ**:
- **åç«¯**: Python 3.11 + FastAPI 0.104+ + Pydantic 2.5+
- **å‰ç«¯**: Vue 3.4+ + TypeScript 5.0+ + Pinia 2.x

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½å®Œæˆæ ‡å‡† (Definition of Done)](#åŠŸèƒ½å®Œæˆæ ‡å‡†-definition-of-done)
2. [ä»£ç è´¨é‡æ ‡å‡†](#ä»£ç è´¨é‡æ ‡å‡†)
3. [æ€§èƒ½æ ‡å‡†](#æ€§èƒ½æ ‡å‡†)
4. [å®‰å…¨æ ‡å‡†](#å®‰å…¨æ ‡å‡†)
5. [æµ‹è¯•äº¤ä»˜æ ‡å‡†](#æµ‹è¯•äº¤ä»˜æ ‡å‡†)
6. [éƒ¨ç½²å’Œå‘å¸ƒæ ‡å‡†](#éƒ¨ç½²å’Œå‘å¸ƒæ ‡å‡†)
7. [è´¨é‡é—¨ç¦æ£€æŸ¥æµç¨‹](#è´¨é‡é—¨ç¦æ£€æŸ¥æµç¨‹)

---

## åŠŸèƒ½å®Œæˆæ ‡å‡† (Definition of Done)

### 1.1 ä»£ç å®Œæˆæ ‡å‡†

**å¼ºåˆ¶æ€§è¦æ±‚** (å¿…é¡»å…¨éƒ¨æ»¡è¶³æ‰èƒ½åˆå¹¶):
- [ ] åŠŸèƒ½å®ç°å®Œæ•´ï¼Œç¬¦åˆç”¨æˆ·æ•…äº‹çš„éªŒæ”¶æ ‡å‡†
- [ ] å‰åç«¯ä»£ç é€šè¿‡ä»£ç å®¡æŸ¥ (è‡³å°‘ 1 äºº Approve)
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ (ESLint/Prettier/Black/Ruff æ£€æŸ¥é€šè¿‡)
- [ ] æ‰€æœ‰å‡½æ•°/ç±»/ç»„ä»¶æœ‰æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- [ ] **ç¦æ­¢ TODO/FIXME/HACK æ³¨é‡Š** (å¿…é¡»å®Œæˆæˆ–åˆ›å»ºæ–°çš„ç”¨æˆ·æ•…äº‹)
- [ ] ä»£ç å·²æäº¤åˆ° feature åˆ†æ”¯ï¼ŒPull Request å·²åˆ›å»º
- [ ] CI/CD æµæ°´çº¿å…¨éƒ¨é€šè¿‡ (lint + test + build)

**ä»£ç è§„èŒƒæ£€æŸ¥æ¸…å•**:

```yaml
å‰ç«¯ä»£ç :
  - [ ] ç»„ä»¶ä½¿ç”¨ <script setup lang="ts"> è¯­æ³•
  - [ ] Props å’Œ Emits ä½¿ç”¨ TypeScript ç±»å‹å®šä¹‰
  - [ ] Composable å‡½æ•°ä»¥ use å¼€å¤´
  - [ ] å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE
  - [ ] æ–‡ä»¶åä½¿ç”¨ PascalCase (ç»„ä»¶) æˆ– camelCase (å·¥å…·å‡½æ•°)
  - [ ] ç¦æ­¢ä½¿ç”¨ any ç±»å‹ (é™¤éæœ‰å……åˆ†ç†ç”±å¹¶æ³¨é‡Š)
  - [ ] æ—  console.log/debugger æ®‹ç•™

åç«¯ä»£ç :
  - [ ] å‡½æ•°/ç±»æœ‰å®Œæ•´çš„ type hints
  - [ ] Pydantic æ¨¡å‹æœ‰å®Œæ•´çš„å­—æ®µéªŒè¯å’Œç¤ºä¾‹
  - [ ] å¼‚æ­¥å‡½æ•°ä½¿ç”¨ async def
  - [ ] æ•°æ®åº“æŸ¥è¯¢ä½¿ç”¨ SQLAlchemy å¼‚æ­¥ API
  - [ ] å¼‚å¸¸å¤„ç†å®Œæ•´ (ä¸åå¼‚å¸¸)
  - [ ] æ—¥å¿—è®°å½•å®Œå–„ (INFO/WARNING/ERROR çº§åˆ«)
  - [ ] æ—  print() è°ƒè¯•è¯­å¥æ®‹ç•™
```

---

### 1.2 æµ‹è¯•å®Œæˆæ ‡å‡†

**è¦†ç›–ç‡è¦æ±‚**:
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80% (å‰ç«¯)ã€â‰¥ 85% (åç«¯)
- [ ] é›†æˆæµ‹è¯•è¦†ç›–ç‡ â‰¥ 60%
- [ ] E2E æµ‹è¯•è¦†ç›–æ ¸å¿ƒç”¨æˆ·æµç¨‹ (è‡³å°‘ 5 ä¸ªåœºæ™¯)
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (ç»¿è‰²çŠ¶æ€)
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ (å¦‚æ¶‰åŠå…³é”®è·¯å¾„)
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡ (å¦‚æ¶‰åŠè®¤è¯/æˆæƒ/æ•°æ®å¤„ç†)

**æµ‹è¯•åœºæ™¯æ£€æŸ¥æ¸…å•**:

```yaml
å•å…ƒæµ‹è¯•:
  - [ ] æ­£å¸¸æƒ…å†µæµ‹è¯•
  - [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯• (ç©ºå€¼ã€æå€¼ã€ç‰¹æ®Šå­—ç¬¦)
  - [ ] å¼‚å¸¸æƒ…å†µæµ‹è¯• (é”™è¯¯è¾“å…¥ã€ç½‘ç»œæ•…éšœ)
  - [ ] å¹¶å‘åœºæ™¯æµ‹è¯• (å¦‚é€‚ç”¨)

é›†æˆæµ‹è¯•:
  - [ ] API ç«¯ç‚¹å®Œæ•´æµ‹è¯• (CRUD)
  - [ ] æ•°æ®åº“é›†æˆæµ‹è¯• (ä½¿ç”¨äº‹åŠ¡å›æ»š)
  - [ ] å¤–éƒ¨æœåŠ¡ Mock æµ‹è¯•
  - [ ] è®¤è¯æˆæƒæµç¨‹æµ‹è¯•

E2E æµ‹è¯•:
  - [ ] æ ¸å¿ƒç”¨æˆ·æµç¨‹ (ç™»å½• â†’ åˆ›å»ºé¡¹ç›® â†’ ç¼–è¾‘ â†’ å¯¼å‡º)
  - [ ] é”™è¯¯æç¤ºå’Œæ¢å¤æµç¨‹
  - [ ] è·¨æµè§ˆå™¨å…¼å®¹æ€§ (Chrome/Firefox/Safari)
  - [ ] å“åº”å¼å¸ƒå±€æµ‹è¯• (Desktop/Tablet/Mobile)
```

**æµ‹è¯•æŠ¥å‘Šè¦æ±‚**:
- [ ] å•å…ƒæµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ (HTML å’Œ Terminal)
- [ ] è¦†ç›–ç‡æŠ¥å‘Šå·²ç”Ÿæˆ (Cobertura XML)
- [ ] E2E æµ‹è¯•æˆªå›¾/è§†é¢‘å·²ä¿å­˜ (å¤±è´¥åœºæ™¯)
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ (å¦‚é€‚ç”¨)

---

### 1.3 æ–‡æ¡£å®Œæˆæ ‡å‡†

**æŠ€æœ¯æ–‡æ¡£è¦æ±‚**:
- [ ] API æ–‡æ¡£æ›´æ–° (OpenAPI è§„èŒƒè‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨æ›´æ–°)
- [ ] ç»„ä»¶æ–‡æ¡£æ›´æ–° (Storybook æˆ– Vue æ–‡æ¡£)
- [ ] README æ›´æ–° (å¦‚æœ‰æ–°çš„ç¯å¢ƒå˜é‡æˆ–ä¾èµ–)
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬å·²ï¿½ï¿½ï¿½å»ºå¹¶æµ‹è¯•
- [ ] ç”¨æˆ·æ•…äº‹çš„éªŒæ”¶æ ‡å‡†å·²éªŒè¯å¹¶è®°å½•

**API æ–‡æ¡£æ£€æŸ¥æ¸…å•**:

```yaml
OpenAPI è§„èŒƒ:
  - [ ] ç«¯ç‚¹è·¯å¾„æ­£ç¡® (GET/POST/PUT/DELETE)
  - [ ] è¯·æ±‚ Schema å®Œæ•´ (å¿…å¡«å­—æ®µã€ç±»å‹ã€èŒƒå›´)
  - [ ] å“åº” Schema å®Œæ•´ (200/201/204/400/401/404/500)
  - [ ] ç¤ºä¾‹æ•°æ®å®Œæ•´ (example å­—æ®µ)
  - [ ] è®¤è¯æ–¹å¼å®šä¹‰ (JWT Bearer Token)
  - [ ] é”™è¯¯å“åº”ç¤ºä¾‹ (error code + message)
```

**æ•°æ®åº“è¿ç§»æ£€æŸ¥æ¸…å•**:

```yaml
Alembic è¿ç§»è„šæœ¬:
  - [ ] upgrade() æ–¹æ³•å®Œæ•´
  - [ ] downgrade() æ–¹æ³•å®Œæ•´ (å¯å›é€€)
  - [ ] åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æˆåŠŸ
  - [ ] è¿ç§»å‰åæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
  - [ ] å¤§æ•°æ®é‡è¿ç§»æœ‰æ€§èƒ½ä¼˜åŒ– (æ‰¹é‡å¤„ç†ã€ç´¢å¼•ä¼˜åŒ–)
```

---

### 1.4 æ€§èƒ½å®Œæˆæ ‡å‡†

**API å“åº”æ—¶é—´æ ‡å‡†**:

| ç«¯ç‚¹ç±»å‹ | P50 | P95 | P99 | æ£€æµ‹å·¥å…· |
|---------|-----|-----|-----|----------|
| ç®€å• CRUD | < 100ms | < 200ms | < 500ms | Apache Bench |
| å¤æ‚æŸ¥è¯¢ | < 200ms | < 500ms | < 1000ms | Locust |
| åˆ—è¡¨åˆ†é¡µ | < 150ms | < 300ms | < 600ms | Locust |
| æ–‡ä»¶ä¸Šä¼  (10MB) | < 1s | < 3s | < 5s | Postman |
| AI ç”Ÿæˆ (åŒæ­¥) | < 2s | < 5s | < 10s | Custom Script |
| å¯¼å‡º (å¼‚æ­¥) | < 100ms | < 200ms | < 500ms | Apache Bench |

**å‰ç«¯æ€§èƒ½æŒ‡æ ‡ (Core Web Vitals)**:

| æŒ‡æ ‡ | ç›®æ ‡ | ä¼˜ç§€ | éœ€ä¼˜åŒ– | æ£€æµ‹å·¥å…· |
|------|------|------|--------|----------|
| FCP (First Contentful Paint) | < 1.8s | < 1.5s | > 3s | Lighthouse |
| LCP (Largest Contentful Paint) | < 2.5s | < 2s | > 4s | Lighthouse |
| TTI (Time to Interactive) | < 3.8s | < 3.5s | > 7s | Lighthouse |
| TBT (Total Blocking Time) | < 200ms | < 150ms | > 600ms | Lighthouse |
| CLS (Cumulative Layout Shift) | < 0.1 | < 0.05 | > 0.25 | Lighthouse |

**æ€§èƒ½æµ‹è¯•å‘½ä»¤**:

```bash
# å‰ç«¯æ€§èƒ½æµ‹è¯•
npm install -g @lhci/cli
lhci autorun --collect.url=http://localhost:5173

# åç«¯å‹åŠ›æµ‹è¯• (Apache Bench)
ab -n 1000 -c 10 http://localhost:3000/api/v1/users

# åç«¯å‹åŠ›æµ‹è¯• (Locust)
cd backend/tests/load
locust -f locustfile.py --host=http://localhost:8080 --users=100 --spawn-rate=10
```

**æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•**:

```yaml
å‰ç«¯æ€§èƒ½ä¼˜åŒ–:
  - [ ] è·¯ç”±æ‡’åŠ è½½ (æŒ‰éœ€åŠ è½½é¡µé¢)
  - [ ] ç»„ä»¶æ‡’åŠ è½½ (æŒ‰éœ€åŠ è½½é‡å‹ç»„ä»¶)
  - [ ] å›¾ç‰‡æ‡’åŠ è½½ (ä½¿ç”¨ Intersection Observer)
  - [ ] ä»£ç åˆ†å‰² (Vite è‡ªåŠ¨åˆ†å‰²)
  - [ ] Tree Shaking (ç§»é™¤æœªä½¿ç”¨ä»£ç )
  - [ ] èµ„æºå‹ç¼© (Gzip/Brotli)
  - [ ] CDN åŠ é€Ÿ (é™æ€èµ„æº)

åç«¯æ€§èƒ½ä¼˜åŒ–:
  - [ ] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– (æŸ¥è¯¢é¢‘ç¹çš„å­—æ®µ)
  - [ ] Redis ç¼“å­˜ (çƒ­ç‚¹æ•°æ®ã€ä¼šè¯æ•°æ®)
  - [ ] æŸ¥è¯¢ä¼˜åŒ– (é¿å… N+1 æŸ¥è¯¢)
  - [ ] è¿æ¥æ± é…ç½® (PostgreSQL/Redis)
  - [ ] å¼‚æ­¥å¤„ç† (RabbitMQ + Celery)
  - [ ] æ•°æ®åˆ†é¡µ (å¤§åˆ—è¡¨æŸ¥è¯¢)
```

---

### 1.5 å®‰å…¨å®Œæˆæ ‡å‡†

**å®‰å…¨æ‰«æè¦æ±‚**:
- [ ] é€šè¿‡å®‰å…¨æ‰«æ (Snyk/SonarQube)
- [ ] æ— é«˜å± (Critical) å®‰å…¨æ¼æ´
- [ ] ä¸­å± (High) å®‰å…¨æ¼æ´å·²ä¿®å¤æˆ–æœ‰ç¼“è§£æªæ–½
- [ ] ä½å± (Medium/Low) å®‰å…¨æ¼æ´å·²è®°å½•å¹¶æ’æœŸä¿®å¤

**å®‰å…¨æ‰«æå‘½ä»¤**:

```bash
# Python ä¾èµ–æ‰«æ (Snyk)
cd backend/services/user-service
snyk test --severity-threshold=high

# JavaScript ä¾èµ–æ‰«æ
cd frontend
npm audit --audit-level=moderate

# ä»£ç è´¨é‡æ‰«æ (SonarQube)
sonar-scanner \
  -Dsonar.projectKey=ai-postgen \
  -Dsonar.sources=. \
  -Dsonar.host.url=http://localhost:9000
```

**å®‰å…¨æ£€æŸ¥æ¸…å•**:

```yaml
è®¤è¯å’Œæˆæƒ:
  - [ ] å¯†ç ä½¿ç”¨ bcrypt/argon2 åŠ å¯† (å¼ºåº¦ â‰¥ 10)
  - [ ] JWT Token æœ‰è¿‡æœŸæ—¶é—´ (Access Token 15 åˆ†é’Ÿ)
  - [ ] Refresh Token å­˜å‚¨åœ¨ HttpOnly Cookie
  - [ ] API ç«¯ç‚¹æœ‰æƒé™æ£€æŸ¥ä¸­é—´ä»¶
  - [ ] èµ„æºæ‰€æœ‰æƒéªŒè¯ (ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„é¡¹ç›®)

æ•°æ®å®‰å…¨:
  - [ ] æ•æ„Ÿæ•°æ®å·²åŠ å¯† (å¯†ç ã€Tokenã€PII)
  - [ ] è¾“å…¥éªŒè¯å®Œæ•´ (å‰åç«¯åŒé‡éªŒè¯)
  - [ ] SQL æ³¨å…¥é˜²æŠ¤ (å‚æ•°åŒ–æŸ¥è¯¢)
  - [ ] XSS é˜²æŠ¤ (å†…å®¹è½¬ä¹‰ã€CSP å¤´)
  - [ ] CSRF é˜²æŠ¤ (SameSite Cookieã€Token éªŒè¯)
  - [ ] æ–‡ä»¶ä¸Šä¼ éªŒè¯ (ç±»å‹ã€å¤§å°ã€ç—…æ¯’æ‰«æ)

ç½‘ç»œå®‰å…¨:
  - [ ] HTTPS ä¼ è¾“ (TLS 1.2+)
  - [ ] CORS ä¸¥æ ¼æ£€æŸ¥
  - [ ] é€Ÿç‡é™åˆ¶ (100 req/s å…¨å±€, 10 req/s ç”¨æˆ·)
  - [ ] API Key ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡º
  - [ ] ç¯å¢ƒå˜é‡æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
```

**æ¸—é€æµ‹è¯•æ£€æŸ¥æ¸…å•** (Phase 2 åŠä»¥ä¸Š):

```yaml
OWASP Top 10 æ£€æŸ¥:
  - [ ] A01: Broken Access Control (æƒé™æ§åˆ¶)
  - [ ] A02: Cryptographic Failures (åŠ å¯†å¤±è´¥)
  - [ ] A03: Injection (æ³¨å…¥æ”»å‡»)
  - [ ] A04: Insecure Design (ä¸å®‰å…¨è®¾è®¡)
  - [ ] A05: Security Misconfiguration (å®‰å…¨é…ç½®é”™è¯¯)
  - [ ] A06: Vulnerable Components (æ˜“å—æ”»å‡»ç»„ä»¶)
  - [ ] A07: Identification and Authentication Failures (è®¤è¯å¤±è´¥)
  - [ ] A08: Software and Data Integrity Failures (æ•°æ®å®Œæ•´æ€§)
  - [ ] A09: Security Logging and Monitoring Failures (æ—¥å¿—ç›‘æ§)
  - [ ] A10: Server-Side Request Forgery (SSRF)
```

---

### 1.6 éƒ¨ç½²å®Œæˆæ ‡å‡†

**CI/CD æµæ°´çº¿è¦æ±‚**:
- [ ] é€šè¿‡ CI/CD æµæ°´çº¿ (Lint â†’ Test â†’ Build â†’ Deploy)
- [ ] åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²å¹¶éªŒè¯
- [ ] æ•°æ®åº“è¿ç§»åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡ŒæˆåŠŸ
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½® (å¼€å‘/æµ‹è¯•/é¢„å‘å¸ƒ/ç”Ÿäº§)
- [ ] å›æ»šæ–¹æ¡ˆå·²å‡†å¤‡å¹¶æµ‹è¯•

**éƒ¨ç½²ç¯å¢ƒæ£€æŸ¥æ¸…å•**:

```yaml
æµ‹è¯•ç¯å¢ƒ (Staging):
  - [ ] æ•°æ®åº“è¿ç§»æˆåŠŸ
  - [ ] æ‰€æœ‰æœåŠ¡å¯åŠ¨æ­£å¸¸ (kubectl get pods)
  - [ ] å¥åº·æ£€æŸ¥é€šè¿‡ (Liveness + Readiness Probes)
  - [ ] é›†æˆæµ‹è¯•é€šè¿‡ (API ç«¯ç‚¹æµ‹è¯•)
  - [ ] E2E æµ‹è¯•é€šè¿‡ (æ ¸å¿ƒæµç¨‹æµ‹è¯•)
  - [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ (P95 < ç›®æ ‡å€¼)

ç”Ÿäº§ç¯å¢ƒ (Production):
  - [ ] æ•°æ®åº“å¤‡ä»½å®Œæˆ (éƒ¨ç½²å‰å¤‡ä»½)
  - [ ] å›æ»šæ–¹æ¡ˆå·²éªŒè¯ (kubectl rollout undo)
  - [ ] ç›‘æ§å‘Šè­¦å·²é…ç½® (Prometheus + Grafana)
  - [ ] æ—¥å¿—èšåˆå·²é…ç½® (ELK Stack)
  - [ ] æµé‡ç°åº¦å‘å¸ƒ (5% â†’ 50% â†’ 100%)
  - [ ] çƒŸé›¾æµ‹è¯•é€šè¿‡ (æ ¸å¿ƒåŠŸèƒ½å¿«é€ŸéªŒè¯)
```

**å›æ»šæ£€æŸ¥æ¸…å•**:

```yaml
å›æ»šå‡†å¤‡:
  - [ ] æ•°æ®åº“å¤‡ä»½å®Œæˆ (å¯å›é€€åˆ°è¿ç§»å‰çŠ¶æ€)
  - [ ] é•œåƒç‰ˆæœ¬æ ‡ç­¾æ¸…æ™° (e.g., v1.2.3)
  - [ ] Kubernetes Deployment ä¿ç•™å†å²ç‰ˆæœ¬ (è‡³å°‘ 3 ä¸ª)
  - [ ] å›æ»šå‘½ä»¤å·²æµ‹è¯• (åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯)

å›æ»šæ‰§è¡Œ:
  - [ ] ç«‹å³åœæ­¢æ–°ç‰ˆæœ¬æµé‡
  - [ ] æ‰§è¡Œ Kubernetes å›æ»š (kubectl rollout undo)
  - [ ] æ•°æ®åº“å›æ»š (å¦‚æœ‰è¿ç§»ï¼Œæ‰§è¡Œ downgrade)
  - [ ] éªŒè¯å›æ»šæˆåŠŸ (å¥åº·æ£€æŸ¥ + çƒŸé›¾æµ‹è¯•)
  - [ ] é€šçŸ¥ç›¸å…³äººå‘˜ (å¼€å‘ã€æµ‹è¯•ã€è¿ç»´)
  - [ ] è®°å½•å›æ»šåŸå› å’Œé—®é¢˜ (Post-Mortem)
```

---

## ä»£ç è´¨é‡æ ‡å‡†

### 2.1 å‰ç«¯ä»£ç è§„èŒƒ (Vue 3 + TypeScript)

#### ESLint é…ç½®

**`.eslintrc.cjs`**:

```javascript
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es2021: true
  },
  extends: [
    'plugin:vue/vue3-recommended',
    '@vue/eslint-config-typescript',
    '@vue/eslint-config-prettier'
  ],
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  rules: {
    // Vue è§„åˆ™
    'vue/multi-word-component-names': 'error',
    'vue/no-unused-vars': 'error',
    'vue/component-name-in-template-casing': ['error', 'PascalCase'],
    'vue/require-default-prop': 'warn',

    // TypeScript è§„åˆ™
    '@typescript-eslint/no-explicit-any': 'error',
    '@typescript-eslint/explicit-function-return-type': 'warn',
    '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],

    // é€šç”¨è§„åˆ™
    'no-console': process.env.NODE_ENV === 'production' ? 'error' : 'warn',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'error' : 'warn',
    'prefer-const': 'error',
    'no-var': 'error'
  }
}
```

#### Prettier é…ç½®

**`.prettierrc.json`**:

```json
{
  "semi": false,
  "singleQuote": true,
  "trailingComma": "none",
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "arrowParens": "avoid",
  "endOfLine": "lf"
}
```

#### TypeScript é…ç½®

**`tsconfig.json`**:

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

#### ä»£ç é£æ ¼æ£€æŸ¥æ¸…å•

```yaml
ç»„ä»¶è§„èŒƒ:
  - [ ] ä½¿ç”¨ <script setup lang="ts"> è¯­æ³•
  - [ ] Props ä½¿ç”¨ defineProps<T>() å®šä¹‰ç±»å‹
  - [ ] Emits ä½¿ç”¨ defineEmits<T>() å®šä¹‰ç±»å‹
  - [ ] ç»„ä»¶åç§°ä½¿ç”¨ PascalCase
  - [ ] æ–‡ä»¶åä¸ç»„ä»¶åä¸€è‡´

ç±»å‹å®šä¹‰è§„èŒƒ:
  - [ ] ç¦æ­¢ä½¿ç”¨ any (é™¤éæœ‰å……åˆ†ç†ç”±å¹¶æ³¨é‡Š)
  - [ ] æ¥å£ä½¿ç”¨ interface å®šä¹‰ (ä¸ç”¨ type)
  - [ ] æšä¸¾ä½¿ç”¨ enum æˆ– const assertion
  - [ ] å¯¼å…¥ç±»å‹ä½¿ç”¨ import type

Composable è§„èŒƒ:
  - [ ] æ–‡ä»¶åä»¥ use å¼€å¤´ (e.g., useAuth.ts)
  - [ ] è¿”å›å¯¹è±¡ä½¿ç”¨ ref/reactive
  - [ ] è¿”å›å‡½æ•°ä½¿ç”¨ const å£°æ˜
  - [ ] ä½¿ç”¨ onMounted/onUnmounted ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

å‘½åè§„èŒƒ:
  - [ ] å˜é‡ä½¿ç”¨ camelCase
  - [ ] å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE
  - [ ] ç»„ä»¶ä½¿ç”¨ PascalCase
  - [ ] å·¥å…·å‡½æ•°ä½¿ç”¨ camelCase
```

---

### 2.2 åç«¯ä»£ç è§„èŒƒ (Python + FastAPI)

#### Black é…ç½®

**`pyproject.toml`**:

```toml
[tool.black]
line-length = 100
target-version = ['py311']
include = '\.pyi?$'
extend-exclude = '''
/(
  # æ’é™¤ç›®å½•
  \.eggs
  | \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | _build
  | buck-out
  | build
  | dist
)/
'''
```

#### Ruff é…ç½®

**`pyproject.toml`**:

```toml
[tool.ruff]
select = ["E", "F", "I", "N", "W", "UP", "B", "A", "C4", "DTZ", "T10", "EM", "ISC", "ICN", "PIE", "PT", "Q", "RET", "SIM", "TID", "ARG", "ERA", "PD", "PGH", "PL", "TRY", "RUF"]
ignore = ["E501", "B008"]  # E501: line too long (Black å¤„ç†), B008: function calls in argument defaults
line-length = 100
target-version = "py311"

[tool.ruff.per-file-ignores]
"__init__.py" = ["F401"]  # å…è®¸æœªä½¿ç”¨çš„å¯¼å…¥
"tests/**/*.py" = ["ARG", "PLR2004"]  # æµ‹è¯•æ–‡ä»¶å…è®¸é­”æ³•æ•°å­—

[tool.ruff.isort]
known-first-party = ["app"]
```

#### mypy é…ç½®

**`pyproject.toml`**:

```toml
[tool.mypy]
python_version = "3.11"
strict = true
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_any_generics = true
check_untyped_defs = true
no_implicit_reexport = true
warn_redundant_casts = true
warn_unused_ignores = true

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false
```

#### pytest é…ç½®

**`pyproject.toml`**:

```toml
[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "--cov=app",
    "--cov-report=term-missing",
    "--cov-report=html",
    "--cov-report=xml",
    "-v",
    "--tb=short",
    "--strict-markers",
    "--asyncio-mode=auto"
]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "unit: marks tests as unit tests"
]
```

#### ä»£ç é£æ ¼æ£€æŸ¥æ¸…å•

```yaml
ç±»å‹æç¤ºè§„èŒƒ:
  - [ ] æ‰€æœ‰å‡½æ•°æœ‰ç±»å‹æç¤º (å‚æ•°å’Œè¿”å›å€¼)
  - [ ] Pydantic æ¨¡å‹æœ‰å®Œæ•´å­—æ®µç±»å‹
  - [ ] å¼‚æ­¥å‡½æ•°ä½¿ç”¨ async def
  - [ ] ä½¿ç”¨ typing æ¨¡å—ç±»å‹ (List, Dict, Optional)

Pydantic æ¨¡å‹è§„èŒƒ:
  - [ ] ä½¿ç”¨ Field() å®šä¹‰å­—æ®µéªŒè¯
  - [ ] æœ‰ Config ç±»é…ç½® (from_attributes=True)
  - [ ] æœ‰ json_schema_extra ç¤ºä¾‹æ•°æ®
  - [ ] å­—æ®µæœ‰æè¿° (description)

FastAPI ç«¯ç‚¹è§„èŒƒ:
  - [ ] ä½¿ç”¨ response_model æŒ‡å®šè¿”å›ç±»å‹
  - [ ] ä½¿ç”¨ status_code æŒ‡å®šçŠ¶æ€ç 
  - [ ] æœ‰å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸² (æè¿°ã€å‚æ•°ã€è¿”å›å€¼)
  - [ ] é”™è¯¯å¤„ç†ä½¿ç”¨ HTTPException
  - [ ] ä¾èµ–æ³¨å…¥ä½¿ç”¨ Depends()

æ•°æ®åº“æ“ä½œè§„èŒƒ:
  - [ ] ä½¿ç”¨ SQLAlchemy async API
  - [ ] æŸ¥è¯¢ä½¿ç”¨ select() è€Œé query()
  - [ ] é¿å… N+1 æŸ¥è¯¢ (ä½¿ç”¨ joinedload/selectinload)
  - [ ] äº‹åŠ¡ä½¿ç”¨ async with db.begin()
  - [ ] é”™è¯¯å¤„ç†å®Œæ•´ (å›æ»šã€æ—¥å¿—)

æ—¥å¿—è§„èŒƒ:
  - [ ] ä½¿ç”¨ logging æ¨¡å— (ä¸ç”¨ print)
  - [ ] æ—¥å¿—çº§åˆ«æ­£ç¡® (DEBUG/INFO/WARNING/ERROR/CRITICAL)
  - [ ] æ•æ„Ÿä¿¡æ¯ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡º (å¯†ç ã€Token)
  - [ ] æ—¥å¿—æ¶ˆæ¯æ¸…æ™° (åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯)
```

---

### 2.3 æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

#### å‰ç«¯æµ‹è¯• (Vitest + Playwright)

**è¦†ç›–ç‡ç›®æ ‡**:
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- ç»„ä»¶æµ‹è¯•è¦†ç›–æ‰€æœ‰ Props/Emits
- Composable æµ‹è¯•è¦†ç›–æ‰€æœ‰åˆ†æ”¯
- E2E æµ‹è¯•è¦†ç›–æ ¸å¿ƒç”¨æˆ·æµç¨‹ (ç™»å½•ã€åˆ›å»ºé¡¹ç›®ã€ç¼–è¾‘ã€å¯¼å‡º)

**æµ‹è¯•å‘½ä»¤**:

```bash
# å•å…ƒæµ‹è¯•
npm run test:unit

# å•å…ƒæµ‹è¯• (è¦†ç›–ç‡)
npm run test:unit -- --coverage

# E2E æµ‹è¯•
npm run test:e2e

# E2E æµ‹è¯• (è°ƒè¯•æ¨¡å¼)
npm run test:e2e -- --debug
```

**Vitest é…ç½®** (`vitest.config.ts`):

```typescript
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import path from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  },
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html', 'lcov'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.d.ts',
        '**/*.config.*',
        '**/mockData',
        'src/main.ts'
      ],
      lines: 80,
      functions: 80,
      branches: 80,
      statements: 80
    }
  }
})
```

---

#### åç«¯æµ‹è¯• (pytest)

**è¦†ç›–ç‡ç›®æ ‡**:
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 85%
- API æµ‹è¯•è¦†ç›–æ‰€æœ‰ç«¯ç‚¹ (æ­£å¸¸ + å¼‚å¸¸æƒ…å†µ)
- æ•°æ®åº“æµ‹è¯•ä½¿ç”¨äº‹åŠ¡å›æ»š (ä¸æ±¡æŸ“æµ‹è¯•ç¯å¢ƒ)
- å¼‚æ­¥ä»»åŠ¡æµ‹è¯•ä½¿ç”¨ Mock (ä¸ä¾èµ–çœŸå®é˜Ÿåˆ—)

**æµ‹è¯•å‘½ä»¤**:

```bash
# å•å…ƒæµ‹è¯•
pytest tests/

# å•å…ƒæµ‹è¯• (è¦†ç›–ç‡)
pytest tests/ --cov=app --cov-report=html --cov-report=term

# å•å…ƒæµ‹è¯• (è¯¦ç»†è¾“å‡º)
pytest tests/ -v -s

# å•å…ƒæµ‹è¯• (æ ‡è®°ç­›é€‰)
pytest tests/ -m "not slow"  # æ’é™¤æ…¢é€Ÿæµ‹è¯•
pytest tests/ -m "unit"      # ä»…è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/ -m "integration"  # ä»…è¿è¡Œé›†æˆæµ‹è¯•
```

**æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥æ¸…å•**:

```yaml
å•å…ƒæµ‹è¯•:
  - [ ] ä¸šåŠ¡é€»è¾‘å‡½æ•°è¦†ç›– â‰¥ 90%
  - [ ] Pydantic æ¨¡å‹éªŒè¯æµ‹è¯•å®Œæ•´
  - [ ] å·¥å…·å‡½æ•°æµ‹è¯•è¦†ç›–è¾¹ç•Œæƒ…å†µ
  - [ ] å¼‚å¸¸å¤„ç†æµ‹è¯•å®Œæ•´

é›†æˆæµ‹è¯•:
  - [ ] API ç«¯ç‚¹ CRUD å®Œæ•´æµ‹è¯•
  - [ ] è®¤è¯æˆæƒæµç¨‹æµ‹è¯•
  - [ ] æ•°æ®åº“äº‹åŠ¡æµ‹è¯• (ä½¿ç”¨ rollback)
  - [ ] å¤–éƒ¨æœåŠ¡ Mock æµ‹è¯•

E2E æµ‹è¯•:
  - [ ] æ ¸å¿ƒç”¨æˆ·æµç¨‹æµ‹è¯• (5+ åœºæ™¯)
  - [ ] è·¨æœåŠ¡é›†æˆæµ‹è¯•
  - [ ] é”™è¯¯æ¢å¤æµ‹è¯•
  - [ ] æ€§èƒ½æµ‹è¯• (å¦‚é€‚ç”¨)
```

---

## æ€§èƒ½æ ‡å‡†

### 3.1 API å“åº”æ—¶é—´æ ‡å‡†

**æ€§èƒ½ç›®æ ‡è¡¨**:

| ç«¯ç‚¹ç±»å‹ | P50 | P95 | P99 | ï¿½ï¿½ï¿½æ—¶é˜ˆå€¼ |
|---------|-----|-----|-----|----------|
| ç®€å• CRUD (GET/POST) | < 100ms | < 200ms | < 500ms | 2s |
| å¤æ‚æŸ¥è¯¢ (JOIN/èšåˆ) | < 200ms | < 500ms | < 1000ms | 5s |
| åˆ—è¡¨åˆ†é¡µ (Limit/Offset) | < 150ms | < 300ms | < 600ms | 3s |
| æ–‡ä»¶ä¸Šä¼  (10MB) | < 1s | < 3s | < 5s | 30s |
| AI ç”Ÿæˆ (åŒæ­¥) | < 2s | < 5s | < 10s | 30s |
| å¯¼å‡ºä»»åŠ¡åˆ›å»º (å¼‚æ­¥) | < 100ms | < 200ms | < 500ms | 2s |

**æ€§èƒ½æµ‹è¯•å·¥å…·**:

```bash
# Apache Bench (ç®€å•å‹æµ‹)
ab -n 1000 -c 10 http://localhost:8080/api/v1/users

# Locust (å¤æ‚å‹æµ‹)
cd backend/tests/load
locust -f locustfile.py --host=http://localhost:8080 --users=100 --spawn-rate=10 --run-time=60s
```

**Locust å‹æµ‹è„šæœ¬ç¤ºä¾‹** (`locustfile.py`):

```python
from locust import HttpUser, task, between
import random

class PosterGenUser(HttpUser):
    wait_time = between(1, 5)  # ç”¨æˆ·æ“ä½œé—´éš” 1-5 ç§’

    def on_start(self):
        """ç™»å½•è·å– Token"""
        response = self.client.post("/api/v1/auth/login", json={
            "email": "test@example.com",
            "password": "Test1234"
        })
        self.token = response.json()["access_token"]
        self.headers = {"Authorization": f"Bearer {self.token}"}

    @task(3)  # æƒé‡ 3
    def get_projects(self):
        """è·å–é¡¹ç›®åˆ—è¡¨"""
        self.client.get("/api/v1/projects", headers=self.headers)

    @task(2)  # æƒé‡ 2
    def get_project_detail(self):
        """è·å–é¡¹ç›®è¯¦æƒ…"""
        project_id = random.choice(["proj_1", "proj_2", "proj_3"])
        self.client.get(f"/api/v1/projects/{project_id}", headers=self.headers)

    @task(1)  # æƒé‡ 1
    def create_project(self):
        """åˆ›å»ºé¡¹ç›®"""
        self.client.post("/api/v1/projects", headers=self.headers, json={
            "title": f"Test Project {random.randint(1000, 9999)}",
            "canvas_width": 1080,
            "canvas_height": 1080
        })
```

---

### 3.2 å‰ç«¯æ€§èƒ½æŒ‡æ ‡ (Core Web Vitals)

**Lighthouse CI é…ç½®** (`.lighthouserc.json`):

```json
{
  "ci": {
    "collect": {
      "url": ["http://localhost:5173"],
      "numberOfRuns": 3,
      "settings": {
        "preset": "desktop"
      }
    },
    "assert": {
      "assertions": {
        "categories:performance": ["error", { "minScore": 0.9 }],
        "categories:accessibility": ["error", { "minScore": 0.95 }],
        "categories:best-practices": ["error", { "minScore": 0.95 }],
        "categories:seo": ["warn", { "minScore": 0.9 }],
        "first-contentful-paint": ["error", { "maxNumericValue": 1800 }],
        "largest-contentful-paint": ["error", { "maxNumericValue": 2500 }],
        "cumulative-layout-shift": ["error", { "maxNumericValue": 0.1 }],
        "total-blocking-time": ["error", { "maxNumericValue": 200 }]
      }
    },
    "upload": {
      "target": "temporary-public-storage"
    }
  }
}
```

**æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•**:

```yaml
åŠ è½½æ€§èƒ½:
  - [ ] é¦–å±æ¸²æŸ“æ—¶é—´ < 1.8s (FCP)
  - [ ] æœ€å¤§å†…å®¹ç»˜åˆ¶ < 2.5s (LCP)
  - [ ] å¯äº¤äº’æ—¶é—´ < 3.8s (TTI)
  - [ ] JavaScript åŒ…å¤§å° < 500KB (gzip)
  - [ ] CSS åŒ…å¤§å° < 50KB (gzip)

è¿è¡Œæ—¶æ€§èƒ½:
  - [ ] æ€»é˜»å¡æ—¶é—´ < 200ms (TBT)
  - [ ] ç´¯ç§¯å¸ƒå±€åç§» < 0.1 (CLS)
  - [ ] å¸§ç‡ â‰¥ 60 FPS (ç¼–è¾‘å™¨æ“ä½œ)
  - [ ] å†…å­˜å ç”¨ < 100MB (å•ç”¨æˆ·)

ä¼˜åŒ–æªæ–½:
  - [ ] è·¯ç”±æ‡’åŠ è½½ (defineAsyncComponent)
  - [ ] ç»„ä»¶æ‡’åŠ è½½ (Suspense)
  - [ ] å›¾ç‰‡æ‡’åŠ è½½ (Intersection Observer)
  - [ ] ä»£ç åˆ†å‰² (Vite è‡ªåŠ¨)
  - [ ] Tree Shaking (ç§»é™¤æœªä½¿ç”¨ä»£ç )
  - [ ] èµ„æºå‹ç¼© (Gzip/Brotli)
  - [ ] CDN åŠ é€Ÿ (é™æ€èµ„æº)
```

---

### 3.3 æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æ ‡å‡†

**æŸ¥è¯¢æ€§èƒ½ç›®æ ‡**:

| æŸ¥è¯¢ç±»å‹ | ç›®æ ‡ | ä¼˜åŒ–æªæ–½ |
|---------|------|----------|
| ä¸»é”®æŸ¥è¯¢ | < 10ms | ä¸»é”®ç´¢å¼• (è‡ªåŠ¨) |
| ç®€å•è¿‡æ»¤ (WHERE) | < 50ms | å•åˆ—ç´¢å¼• |
| å¤æ‚ JOIN | < 100ms | å¤åˆç´¢å¼• + æŸ¥è¯¢ä¼˜åŒ– |
| èšåˆæŸ¥è¯¢ (COUNT/SUM) | < 200ms | ç´¢å¼• + ç‰©åŒ–è§†å›¾ |
| å…¨æ–‡æœç´¢ (LIKE) | < 300ms | PostgreSQL FTS + GIN ç´¢å¼• |

**ç´¢å¼•ä¼˜åŒ–æ¸…å•** (åŸºäº PRD å’Œæ¶æ„è®¾è®¡):

```sql
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE INDEX idx_users_email ON users (email);  -- ç™»å½•æŸ¥è¯¢
CREATE INDEX idx_users_username ON users (username);  -- ç”¨æˆ·åæœç´¢
CREATE INDEX idx_users_created_at ON users (created_at);  -- æ—¶é—´æ’åº

-- é¡¹ç›®è¡¨ç´¢å¼•
CREATE INDEX idx_projects_user_id ON projects (user_id);  -- ç”¨æˆ·çš„é¡¹ç›®åˆ—è¡¨
CREATE INDEX idx_projects_status ON projects (status);  -- çŠ¶æ€ç­›é€‰
CREATE INDEX idx_projects_created_at ON projects (created_at DESC);  -- æ—¶é—´æ’åº
CREATE INDEX idx_projects_user_status ON projects (user_id, status);  -- å¤åˆæŸ¥è¯¢

-- è®¾è®¡è¡¨ç´¢å¼•
CREATE INDEX idx_designs_project_id ON designs (project_id);  -- é¡¹ç›®çš„è®¾è®¡åˆ—è¡¨
CREATE INDEX idx_designs_version ON designs (version);  -- ç‰ˆæœ¬æŸ¥è¯¢
CREATE INDEX idx_designs_created_at ON designs (created_at DESC);  -- æ—¶é—´æ’åº

-- å¯¼å‡ºè¡¨ç´¢å¼•
CREATE INDEX idx_exports_user_id ON exports (user_id);  -- ç”¨æˆ·çš„å¯¼å‡ºåˆ—è¡¨
CREATE INDEX idx_exports_project_id ON exports (project_id);  -- é¡¹ç›®çš„å¯¼å‡ºåˆ—è¡¨
CREATE INDEX idx_exports_status ON exports (status);  -- çŠ¶æ€æŸ¥è¯¢
CREATE INDEX idx_exports_created_at ON exports (created_at DESC);  -- æ—¶é—´æ’åº

-- å…¨æ–‡æœç´¢ç´¢å¼•
CREATE INDEX idx_projects_title_gin ON projects USING gin (to_tsvector('simple', title));
CREATE INDEX idx_projects_description_gin ON projects USING gin (to_tsvector('simple', description));
```

**æŸ¥è¯¢ä¼˜åŒ–æ£€æŸ¥æ¸…å•**:

```yaml
æŸ¥è¯¢åˆ†æ:
  - [ ] ä½¿ç”¨ EXPLAIN ANALYZE åˆ†ææ…¢æŸ¥è¯¢
  - [ ] è¯†åˆ« Sequential Scan (åº”ä½¿ç”¨ Index Scan)
  - [ ] é¿å… N+1 æŸ¥è¯¢ (ä½¿ç”¨ joinedload)
  - [ ] é¿å… SELECT * (åªæŸ¥è¯¢éœ€è¦çš„åˆ—)

ç´¢å¼•ä¼˜åŒ–:
  - [ ] WHERE å­å¥å­—æ®µæœ‰ç´¢å¼•
  - [ ] JOIN å­—æ®µæœ‰ç´¢å¼•
  - [ ] ORDER BY å­—æ®µæœ‰ç´¢å¼•
  - [ ] å¤åˆæŸ¥è¯¢ä½¿ç”¨å¤åˆç´¢å¼•

è¿æ¥æ± ä¼˜åŒ–:
  - [ ] Pool Size = (CPUæ ¸å¿ƒæ•° * 2) + ç£ç›˜æ•°
  - [ ] Max Overflow = Pool Size * 2
  - [ ] Pool Recycle = 3600 (1å°æ—¶å›æ”¶è¿æ¥)
  - [ ] Pool Pre Ping = True (æ£€æµ‹æ­»è¿æ¥)
```

**æ…¢æŸ¥è¯¢ç›‘æ§** (`postgresql.conf`):

```ini
# æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®
log_min_duration_statement = 500  # è®°å½•æ‰§è¡Œè¶…è¿‡ 500ms çš„æŸ¥è¯¢
log_statement = 'all'  # è®°å½•æ‰€æœ‰ SQL (å¼€å‘ç¯å¢ƒ)
log_duration = on  # è®°å½•æŸ¥è¯¢è€—æ—¶
```

**æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—**:

```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢ (pg_stat_statements æ‰©å±•)
SELECT
  calls,
  mean_exec_time,
  query
FROM pg_stat_statements
ORDER BY mean_exec_time DESC
LIMIT 10;
```

---

## å®‰å…¨æ ‡å‡†

### 4.1 è®¤è¯æˆæƒæ£€æŸ¥æ¸…å•

**è®¤è¯ (Authentication) æ ‡å‡†**:

```yaml
å¯†ç å®‰å…¨:
  - [ ] ä½¿ç”¨ bcrypt/argon2 åŠ å¯† (å¼ºåº¦ â‰¥ 10)
  - [ ] å¯†ç é•¿åº¦ â‰¥ 8 å­—ç¬¦
  - [ ] å¯†ç åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—
  - [ ] å¯†ç ä¸åœ¨å¸¸è§å¯†ç å­—å…¸ä¸­
  - [ ] å¯†ç é‡ç½®éœ€è¦é‚®ç®±éªŒè¯

Token å®‰å…¨:
  - [ ] Access Token æœ‰æ•ˆæœŸ 15 åˆ†é’Ÿ
  - [ ] Refresh Token æœ‰æ•ˆæœŸ 7 å¤©
  - [ ] Refresh Token å­˜å‚¨åœ¨ HttpOnly Cookie
  - [ ] Token ä½¿ç”¨ HS256/RS256 ç­¾å
  - [ ] Token åŒ…å«å¿…è¦å£°æ˜ (sub, exp, iat)
  - [ ] ç™»å‡ºæ—¶ Token åŠ å…¥é»‘åå•

ä¼šè¯å®‰å…¨:
  - [ ] ä¼šè¯ ID ä½¿ç”¨éšæœºç”Ÿæˆ (UUID)
  - [ ] ä¼šè¯è¶…æ—¶æ—¶é—´ 30 åˆ†é’Ÿ
  - [ ] å¤šè®¾å¤‡ç™»å½•ç®¡ç†
  - [ ] å¼‚å¸¸ç™»å½•å‘Šè­¦ (å¼‚åœ°ã€æ–°è®¾å¤‡)
```

**æˆæƒ (Authorization) æ ‡å‡†**:

```yaml
RBAC æƒé™æ¨¡å‹:
  - [ ] è§’è‰²å®šä¹‰æ¸…æ™° (Admin/User/Viewer)
  - [ ] æƒé™åˆ†é…åˆç† (æœ€å°æƒé™åŸåˆ™)
  - [ ] API ç«¯ç‚¹æœ‰æƒé™æ£€æŸ¥ä¸­é—´ä»¶
  - [ ] å‰ç«¯è·¯ç”±æœ‰æƒé™å®ˆå«

èµ„æºæ‰€æœ‰æƒéªŒè¯:
  - [ ] ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„é¡¹ç›®
  - [ ] åˆ é™¤æ“ä½œéœ€è¦æ‰€æœ‰æƒéªŒè¯
  - [ ] å…±äº«èµ„æºéœ€è¦æƒé™æ£€æŸ¥
  - [ ] ç®¡ç†å‘˜æƒé™ä¸¥æ ¼æ§åˆ¶

è®¢é˜…ç­‰çº§é™åˆ¶:
  - [ ] å…è´¹ç”¨æˆ·é™åˆ¶é¡¹ç›®æ•°é‡
  - [ ] Pro ç”¨æˆ·è§£é”é«˜çº§åŠŸèƒ½
  - [ ] ä¼ä¸šç”¨æˆ·æ”¯æŒå›¢é˜Ÿåä½œ
  - [ ] è¶…å‡ºé…é¢æ—¶å‹å¥½æç¤º
```

**è®¤è¯æˆæƒä»£ç ç¤ºä¾‹** (åç«¯):

```python
# backend/app/core/auth.py
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from sqlalchemy.ext.asyncio import AsyncSession
from app.core.database import get_db
from app.models.user import User

security = HTTPBearer()

async def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: AsyncSession = Depends(get_db)
) -> User:
    """è·å–å½“å‰ç”¨æˆ· (è®¤è¯ä¸­é—´ä»¶)"""
    token = credentials.credentials

    try:
        # éªŒè¯ JWT Token
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        user_id = payload.get("sub")

        if user_id is None:
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="Invalid authentication credentials"
            )
    except JWTError:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid authentication credentials"
        )

    # æŸ¥è¯¢ç”¨æˆ·
    user = await db.get(User, user_id)
    if user is None:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="User not found"
        )

    return user

async def verify_project_ownership(
    project_id: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """éªŒè¯é¡¹ç›®æ‰€æœ‰æƒ (æˆæƒä¸­é—´ä»¶)"""
    project = await db.get(Project, project_id)

    if project is None:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Project not found"
        )

    if project.user_id != current_user.id:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="You don't have permission to access this project"
        )

    return project

# ä½¿ç”¨ç¤ºä¾‹
@router.get("/api/v1/projects/{project_id}")
async def get_project(
    project_id: str,
    current_user: User = Depends(get_current_user),
    project: Project = Depends(verify_project_ownership)
):
    """è·å–é¡¹ç›®è¯¦æƒ… (éœ€è¦è®¤è¯ + æˆæƒ)"""
    return project
```

---

### 4.2 è¾“å…¥éªŒè¯è§„èŒƒ

**å‰ç«¯éªŒè¯ (Zod)**:

```typescript
// src/schemas/user.ts
import { z } from 'zod'

export const userCreateSchema = z.object({
  email: z.string()
    .email('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®')
    .max(255, 'é‚®ç®±æœ€å¤š 255 ä¸ªå­—ç¬¦'),

  password: z.string()
    .min(8, 'å¯†ç è‡³å°‘ 8 ä¸ªå­—ç¬¦')
    .max(100, 'å¯†ç æœ€å¤š 100 ä¸ªå­—ç¬¦')
    .regex(/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)/, 'å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯ã€å°å†™å­—æ¯å’Œæ•°å­—'),

  username: z.string()
    .min(3, 'ç”¨æˆ·åè‡³å°‘ 3 ä¸ªå­—ç¬¦')
    .max(50, 'ç”¨æˆ·åæœ€å¤š 50 ä¸ªå­—ç¬¦')
    .regex(/^[a-zA-Z0-9_]+$/, 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿')
})

export type UserCreate = z.infer<typeof userCreateSchema>

// é¡¹ç›®åˆ›å»ºéªŒè¯
export const projectCreateSchema = z.object({
  title: z.string()
    .min(1, 'é¡¹ç›®æ ‡é¢˜ä¸èƒ½ä¸ºç©º')
    .max(255, 'é¡¹ç›®æ ‡é¢˜æœ€å¤š 255 ä¸ªå­—ç¬¦'),

  description: z.string()
    .max(1000, 'é¡¹ç›®æè¿°æœ€å¤š 1000 ä¸ªå­—ç¬¦')
    .optional(),

  canvas_width: z.number()
    .int('ç”»å¸ƒå®½åº¦å¿…é¡»æ˜¯æ•´æ•°')
    .min(100, 'ç”»å¸ƒå®½åº¦æœ€å° 100px')
    .max(10000, 'ç”»å¸ƒå®½åº¦æœ€å¤§ 10000px')
    .default(1080),

  canvas_height: z.number()
    .int('ç”»å¸ƒé«˜åº¦å¿…é¡»æ˜¯æ•´æ•°')
    .min(100, 'ç”»å¸ƒé«˜åº¦æœ€å° 100px')
    .max(10000, 'ç”»å¸ƒé«˜åº¦æœ€å¤§ 10000px')
    .default(1080)
})

export type ProjectCreate = z.infer<typeof projectCreateSchema>
```

**åç«¯éªŒè¯ (Pydantic)**:

```python
# backend/app/schemas/user.py
from pydantic import BaseModel, EmailStr, constr, Field, validator
import re

class UserCreate(BaseModel):
    """ç”¨æˆ·æ³¨å†Œè¯·æ±‚æ¨¡å‹"""
    email: EmailStr = Field(..., description="é‚®ç®±åœ°å€", max_length=255)
    password: constr(min_length=8, max_length=100) = Field(..., description="å¯†ç  (8-100å­—ç¬¦)")
    username: constr(min_length=3, max_length=50) = Field(..., description="ç”¨æˆ·å (3-50å­—ç¬¦)")

    @validator('password')
    def validate_password_strength(cls, v):
        """éªŒè¯å¯†ç å¼ºåº¦"""
        if not re.search(r'[A-Z]', v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¤§å†™å­—æ¯')
        if not re.search(r'[a-z]', v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå°å†™å­—æ¯')
        if not re.search(r'\d', v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ•°å­—')
        return v

    @validator('username')
    def validate_username_format(cls, v):
        """éªŒè¯ç”¨æˆ·åæ ¼å¼"""
        if not re.match(r'^[a-zA-Z0-9_]+$', v):
            raise ValueError('ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿')
        return v

    class Config:
        json_schema_extra = {
            "example": {
                "email": "user@example.com",
                "password": "SecurePassword123",
                "username": "alice_wang"
            }
        }

# backend/app/schemas/project.py
class ProjectCreate(BaseModel):
    """åˆ›å»ºé¡¹ç›®è¯·æ±‚æ¨¡å‹"""
    title: constr(min_length=1, max_length=255) = Field(..., description="é¡¹ç›®æ ‡é¢˜")
    description: Optional[str] = Field(None, max_length=1000, description="é¡¹ç›®æè¿°")
    canvas_width: int = Field(1080, ge=100, le=10000, description="ç”»å¸ƒå®½åº¦")
    canvas_height: int = Field(1080, ge=100, le=10000, description="ç”»å¸ƒé«˜åº¦")

    class Config:
        json_schema_extra = {
            "example": {
                "title": "åŒ11å¤§ä¿ƒæµ·æŠ¥",
                "description": "ç”µå•†ä¿ƒé”€æ´»åŠ¨æµ·æŠ¥",
                "canvas_width": 1080,
                "canvas_height": 1080
            }
        }
```

**æ–‡ä»¶ä¸Šä¼ éªŒè¯**:

```python
# backend/app/api/v1/endpoints/upload.py
from fastapi import UploadFile, HTTPException
import mimetypes
import magic

ALLOWED_IMAGE_TYPES = {'image/jpeg', 'image/png', 'image/webp', 'image/svg+xml'}
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB

async def validate_image_upload(file: UploadFile):
    """éªŒè¯å›¾ç‰‡ä¸Šä¼ """
    # éªŒè¯æ–‡ä»¶ç±»å‹ (MIME Type)
    content_type = file.content_type
    if content_type not in ALLOWED_IMAGE_TYPES:
        raise HTTPException(
            status_code=400,
            detail=f"Invalid file type: {content_type}. Allowed types: {ALLOWED_IMAGE_TYPES}"
        )

    # éªŒè¯æ–‡ä»¶å¤§å°
    content = await file.read()
    if len(content) > MAX_FILE_SIZE:
        raise HTTPException(
            status_code=400,
            detail=f"File too large: {len(content)} bytes. Max size: {MAX_FILE_SIZE} bytes"
        )

    # éªŒè¯æ–‡ä»¶å†…å®¹ (ä½¿ç”¨ python-magic æ£€æµ‹çœŸå®ç±»å‹)
    file_magic = magic.from_buffer(content, mime=True)
    if file_magic not in ALLOWED_IMAGE_TYPES:
        raise HTTPException(
            status_code=400,
            detail=f"File content type mismatch: {file_magic}"
        )

    # é‡ç½®æ–‡ä»¶æŒ‡é’ˆ
    await file.seek(0)

    return file
```

---

### 4.3 SQL æ³¨å…¥é˜²æŠ¤

**ORM å‚æ•°åŒ–æŸ¥è¯¢** (SQLAlchemy):

```python
# âœ… æ­£ç¡®ï¼šä½¿ç”¨ SQLAlchemy å‚æ•°åŒ–æŸ¥è¯¢
from sqlalchemy import select
from app.models.user import User

async def get_user_by_email(db: AsyncSession, email: str) -> Optional[User]:
    """é€šè¿‡é‚®ç®±æŸ¥è¯¢ç”¨æˆ· (å‚æ•°åŒ–æŸ¥è¯¢)"""
    result = await db.execute(
        select(User).where(User.email == email)
    )
    return result.scalar_one_or_none()

# âŒ é”™è¯¯ï¼šå­—ç¬¦ä¸²æ‹¼æ¥æ„å»º SQL (SQL æ³¨å…¥é£é™©!)
async def get_user_by_email_unsafe(db: AsyncSession, email: str):
    """ä¸å®‰å…¨çš„æŸ¥è¯¢ (ç¦æ­¢ä½¿ç”¨)"""
    query = f"SELECT * FROM users WHERE email = '{email}'"  # å±é™©ï¼
    result = await db.execute(query)
    return result.fetchone()
```

**å¤æ‚æŸ¥è¯¢å‚æ•°åŒ–**:

```python
# å¤æ‚æŸ¥è¯¢å‚æ•°åŒ–
from sqlalchemy import select, and_, or_, bindparam

async def search_projects(
    db: AsyncSession,
    user_id: str,
    keyword: Optional[str] = None,
    status: Optional[str] = None
):
    """æœç´¢é¡¹ç›® (å‚æ•°åŒ–æŸ¥è¯¢)"""
    query = select(Project).where(Project.user_id == user_id)

    # åŠ¨æ€æ·»åŠ æ¡ä»¶
    if keyword:
        query = query.where(
            or_(
                Project.title.ilike(f"%{keyword}%"),
                Project.description.ilike(f"%{keyword}%")
            )
        )

    if status:
        query = query.where(Project.status == status)

    result = await db.execute(query)
    return result.scalars().all()
```

**SQL æ³¨å…¥æµ‹è¯•æ¸…å•**:

```yaml
SQL æ³¨å…¥é˜²æŠ¤æ£€æŸ¥:
  - [ ] æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢ä½¿ç”¨ ORM (SQLAlchemy)
  - [ ] ç¦æ­¢ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ„å»º SQL
  - [ ] å¤æ‚æŸ¥è¯¢ä½¿ç”¨å‚æ•°åŒ– (bindparam)
  - [ ] åŸç”Ÿ SQL (å¦‚å¿…éœ€) ä½¿ç”¨å‚æ•°åŒ– (execute with params)
  - [ ] å®šæœŸè¿è¡Œ SQL æ³¨å…¥æ‰«æå·¥å…· (SQLMap)

å¸¸è§ SQL æ³¨å…¥æµ‹è¯•ç”¨ä¾‹:
  - [ ] email = "' OR '1'='1"
  - [ ] email = "admin'--"
  - [ ] email = "'; DROP TABLE users;--"
  - [ ] keyword = "test%' AND 1=1 UNION SELECT * FROM users--"
```

---

### 4.4 XSS/CSRF é˜²æŠ¤

**XSS (è·¨ç«™è„šæœ¬æ”»å‡») é˜²æŠ¤**:

```yaml
å‰ç«¯ XSS é˜²æŠ¤:
  - [ ] Vue è‡ªåŠ¨è½¬ä¹‰ (ä½¿ç”¨ {{ }} è€Œé v-html)
  - [ ] ç”¨æˆ·è¾“å…¥çš„ HTML ä½¿ç”¨ DOMPurify æ¸…ç†
  - [ ] è®¾ç½® Content-Security-Policy å¤´
  - [ ] Cookie è®¾ç½® HttpOnly æ ‡å¿—

åç«¯ XSS é˜²æŠ¤:
  - [ ] API å“åº”è®¾ç½® X-Content-Type-Options: nosniff
  - [ ] API å“åº”è®¾ç½® X-Frame-Options: DENY
  - [ ] API å“åº”è®¾ç½® X-XSS-Protection: 1; mode=block
  - [ ] å¯Œæ–‡æœ¬å†…å®¹å­˜å‚¨å‰æ¸…ç† (html-sanitizer)
```

**Content-Security-Policy é…ç½®** (Vite):

```typescript
// vite.config.ts
export default defineConfig({
  server: {
    headers: {
      'Content-Security-Policy': [
        "default-src 'self'",
        "script-src 'self' 'unsafe-inline'",  // ç”Ÿäº§ç¯å¢ƒç§»é™¤ unsafe-inline
        "style-src 'self' 'unsafe-inline'",   // ç”Ÿäº§ç¯å¢ƒç§»é™¤ unsafe-inline
        "img-src 'self' data: https:",
        "font-src 'self' data:",
        "connect-src 'self' https://api.example.com",
        "frame-ancestors 'none'"
      ].join('; ')
    }
  }
})
```

**DOMPurify ä½¿ç”¨ç¤ºä¾‹** (å‰ç«¯):

```typescript
// src/utils/sanitize.ts
import DOMPurify from 'dompurify'

export function sanitizeHTML(html: string): string {
  /**
   * æ¸…ç†ç”¨æˆ·è¾“å…¥çš„ HTML (é˜²æ­¢ XSS)
   */
  return DOMPurify.sanitize(html, {
    ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'u', 'a', 'ul', 'ol', 'li'],
    ALLOWED_ATTR: ['href', 'target', 'rel'],
    ALLOW_DATA_ATTR: false
  })
}

// ä½¿ç”¨ç¤ºä¾‹
import { sanitizeHTML } from '@/utils/sanitize'

const userInput = '<script>alert("XSS")</script><p>Hello</p>'
const safeHTML = sanitizeHTML(userInput)  // '<p>Hello</p>'
```

**CSRF (è·¨ç«™è¯·æ±‚ä¼ªé€ ) é˜²æŠ¤**:

```yaml
CSRF é˜²æŠ¤æªæ–½:
  - [ ] API ä½¿ç”¨ JWT Token (æ— çŠ¶æ€ï¼Œå¤©ç„¶é˜² CSRF)
  - [ ] Refresh Token ä½¿ç”¨ SameSite Cookie
  - [ ] æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤ (åˆ é™¤ã€æ”¯ä»˜)
  - [ ] å…³é”®æ“ä½œéœ€è¦å¯†ç æˆ– 2FA éªŒè¯

SameSite Cookie é…ç½®:
  - [ ] SameSite=Strict (ä¸¥æ ¼æ¨¡å¼)
  - [ ] SameSite=Lax (å®½æ¾æ¨¡å¼ï¼Œå…è®¸ GET è·¨ç«™)
  - [ ] Secure æ ‡å¿— (ä»… HTTPS ä¼ è¾“)
  - [ ] HttpOnly æ ‡å¿— (ç¦æ­¢ JavaScript è®¿é—®)
```

**Cookie å®‰å…¨é…ç½®** (åç«¯):

```python
# backend/app/core/security.py
from fastapi import Response

def set_refresh_token_cookie(response: Response, refresh_token: str):
    """è®¾ç½® Refresh Token Cookie (å®‰å…¨é…ç½®)"""
    response.set_cookie(
        key="refresh_token",
        value=refresh_token,
        httponly=True,      # ç¦æ­¢ JavaScript è®¿é—®
        secure=True,        # ä»… HTTPS ä¼ è¾“
        samesite="strict",  # é˜²æ­¢ CSRF
        max_age=7 * 24 * 60 * 60,  # 7 å¤©
        path="/api/v1/auth/refresh"  # é™å®šè·¯å¾„
    )
```

---

### 4.5 æ•æ„Ÿæ•°æ®å¤„ç†è§„èŒƒ

**æ•°æ®åŠ å¯†æ ‡å‡†**:

```yaml
å¯†ç åŠ å¯†:
  - [ ] ä½¿ç”¨ bcrypt/argon2 åŠ å¯† (ä¸å¯é€†)
  - [ ] Salt å¼ºåº¦ â‰¥ 10 (bcrypt rounds)
  - [ ] å¯†ç å“ˆå¸Œå­˜å‚¨ï¼Œç»ä¸å­˜å‚¨æ˜æ–‡
  - [ ] å¯†ç é‡ç½®ä½¿ç”¨ä¸´æ—¶ Token (æœ‰æ•ˆæœŸ 1 å°æ—¶)

Token åŠ å¯†:
  - [ ] JWT ä½¿ç”¨ HS256/RS256 ç­¾å
  - [ ] Secret Key ä½¿ç”¨éšæœºç”Ÿæˆ (â‰¥ 256 bits)
  - [ ] Secret Key å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡
  - [ ] Refresh Token ä½¿ç”¨ UUID v4

æ•æ„Ÿå­—æ®µåŠ å¯†:
  - [ ] èº«ä»½è¯/é“¶è¡Œå¡ä½¿ç”¨ AES-256 åŠ å¯†
  - [ ] åŠ å¯†å¯†é’¥ä½¿ç”¨ KMS ç®¡ç†
  - [ ] åŠ å¯†å¯†é’¥å®šæœŸè½®æ¢ (90 å¤©)
  - [ ] æ•°æ®åº“å¤‡ä»½åŠ å¯†å­˜å‚¨

ä¼ è¾“åŠ å¯†:
  - [ ] HTTPS (TLS 1.2+)
  - [ ] è¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥
  - [ ] HSTS å¼ºåˆ¶ HTTPS
  - [ ] ç¦ç”¨å¼±åŠ å¯†å¥—ä»¶
```

**å¯†ç åŠ å¯†ç¤ºä¾‹** (åç«¯):

```python
# backend/app/core/security.py
from passlib.context import CryptContext

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def hash_password(password: str) -> str:
    """åŠ å¯†å¯†ç  (bcrypt)"""
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """éªŒè¯å¯†ç """
    return pwd_context.verify(plain_password, hashed_password)

# ä½¿ç”¨ç¤ºä¾‹
password = "SecurePassword123"
hashed = hash_password(password)
# $2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW

is_valid = verify_password("SecurePassword123", hashed)  # True
is_valid = verify_password("WrongPassword", hashed)  # False
```

**æ•°æ®è„±æ•æ ‡å‡†**:

```yaml
æ—¥å¿—è„±æ•:
  - [ ] æ—¥å¿—ä¸­ä¸è¾“å‡ºå¯†ç ã€Token
  - [ ] é‚®ç®±è„±æ• (user***@example.com)
  - [ ] æ‰‹æœºå·è„±æ• (138****5678)
  - [ ] èº«ä»½è¯è„±æ• (110101****1234)

API å“åº”è„±æ•:
  - [ ] å¯†ç å­—æ®µä¸è¿”å› (password_hash)
  - [ ] Token ä¸åœ¨æ—¥å¿—ä¸­è®°å½•
  - [ ] æ•æ„Ÿå­—æ®µéƒ¨åˆ†éšè— (èº«ä»½è¯ã€é“¶è¡Œå¡)
  - [ ] é”™è¯¯æ¶ˆæ¯ä¸æ³„éœ²ç³»ç»Ÿä¿¡æ¯

æ•°æ®åº“è„±æ•:
  - [ ] æµ‹è¯•ç¯å¢ƒä½¿ç”¨è„±æ•æ•°æ®
  - [ ] å¼€å‘ç¯å¢ƒç¦æ­¢ä½¿ç”¨ç”Ÿäº§æ•°æ®
  - [ ] æ•æ„Ÿå­—æ®µæŸ¥è¯¢éœ€è¦å®¡è®¡
```

**æ—¥å¿—è„±æ•ç¤ºä¾‹** (åç«¯):

```python
# backend/app/core/logging.py
import logging
import re

def sanitize_log_message(message: str) -> str:
    """è„±æ•æ—¥å¿—æ¶ˆæ¯"""
    # é‚®ç®±è„±æ•
    message = re.sub(
        r'([a-zA-Z0-9._%+-]{1,3})[a-zA-Z0-9._%+-]*@([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})',
        r'\1***@\2',
        message
    )

    # æ‰‹æœºå·è„±æ•
    message = re.sub(r'(\d{3})\d{4}(\d{4})', r'\1****\2', message)

    # Token è„±æ•
    message = re.sub(r'Bearer\s+[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+', 'Bearer ***', message)

    return message

logger = logging.getLogger(__name__)

# ä½¿ç”¨ç¤ºä¾‹
user_email = "alice@example.com"
logger.info(sanitize_log_message(f"User {user_email} logged in"))
# è¾“å‡º: User ali***@example.com logged in
```

---

## æµ‹è¯•äº¤ä»˜æ ‡å‡†

### 5.1 å•å…ƒæµ‹è¯•è¦æ±‚

**å‰ç«¯å•å…ƒæµ‹è¯• (Vitest)**:

```typescript
// tests/unit/components/UserCard.spec.ts
import { mount } from '@vue/test-utils'
import { describe, it, expect } from 'vitest'
import UserCard from '@/components/UserCard.vue'

describe('UserCard', () => {
  it('renders user information correctly', () => {
    const wrapper = mount(UserCard, {
      props: {
        user: {
          id: '1',
          username: 'testuser',
          email: 'test@example.com',
          avatar_url: 'https://example.com/avatar.jpg'
        }
      }
    })

    expect(wrapper.text()).toContain('testuser')
    expect(wrapper.text()).toContain('test@example.com')
    expect(wrapper.find('img').attributes('src')).toBe('https://example.com/avatar.jpg')
  })

  it('emits delete event when delete button clicked', async () => {
    const wrapper = mount(UserCard, {
      props: {
        user: { id: '1', username: 'test', email: 'test@example.com' }
      }
    })

    await wrapper.find('[data-testid="delete-btn"]').trigger('click')

    expect(wrapper.emitted('delete')).toBeTruthy()
    expect(wrapper.emitted('delete')?.[0]).toEqual(['1'])
  })

  it('handles missing avatar gracefully', () => {
    const wrapper = mount(UserCard, {
      props: {
        user: { id: '1', username: 'test', email: 'test@example.com', avatar_url: null }
      }
    })

    const avatar = wrapper.find('[data-testid="avatar"]')
    expect(avatar.classes()).toContain('avatar-placeholder')
  })
})
```

**åç«¯å•å…ƒæµ‹è¯• (pytest)**:

```python
# tests/unit/test_user_service.py
import pytest
from app.services.user_service import UserService
from app.schemas.user import UserCreate

@pytest.mark.asyncio
async def test_create_user(db_session):
    """æµ‹è¯•åˆ›å»ºç”¨æˆ·"""
    user_data = UserCreate(
        email="test@example.com",
        password="Test1234",
        username="testuser"
    )

    user = await UserService.create_user(db_session, user_data)

    assert user.email == "test@example.com"
    assert user.username == "testuser"
    assert user.password_hash != "Test1234"  # å¯†ç å·²åŠ å¯†
    assert user.id is not None
    assert user.created_at is not None

@pytest.mark.asyncio
async def test_create_duplicate_user_raises_error(db_session):
    """æµ‹è¯•åˆ›å»ºé‡å¤ç”¨æˆ·æŠ›å‡ºé”™è¯¯"""
    user_data = UserCreate(
        email="test@example.com",
        password="Test1234",
        username="testuser"
    )

    # åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·
    await UserService.create_user(db_session, user_data)

    # å°è¯•åˆ›å»ºé‡å¤ç”¨æˆ·
    with pytest.raises(ValueError, match="Email already exists"):
        await UserService.create_user(db_session, user_data)

@pytest.mark.asyncio
async def test_authenticate_user_success(db_session):
    """æµ‹è¯•ç”¨æˆ·è®¤è¯æˆåŠŸ"""
    # åˆ›å»ºç”¨æˆ·
    user_data = UserCreate(
        email="test@example.com",
        password="Test1234",
        username="testuser"
    )
    await UserService.create_user(db_session, user_data)

    # è®¤è¯ç”¨æˆ·
    user = await UserService.authenticate(db_session, "test@example.com", "Test1234")

    assert user is not None
    assert user.email == "test@example.com"

@pytest.mark.asyncio
async def test_authenticate_user_wrong_password(db_session):
    """æµ‹è¯•ç”¨æˆ·è®¤è¯å¤±è´¥ (é”™è¯¯å¯†ç )"""
    # åˆ›å»ºç”¨æˆ·
    user_data = UserCreate(
        email="test@example.com",
        password="Test1234",
        username="testuser"
    )
    await UserService.create_user(db_session, user_data)

    # è®¤è¯ç”¨æˆ· (é”™è¯¯å¯†ç )
    user = await UserService.authenticate(db_session, "test@example.com", "WrongPassword")

    assert user is None
```

**å•å…ƒæµ‹è¯•æ£€æŸ¥æ¸…å•**:

```yaml
æµ‹è¯•è¦†ç›–:
  - [ ] è¦†ç›–ç‡ â‰¥ 80% (å‰ç«¯)ã€â‰¥ 85% (åç«¯)
  - [ ] æ­£å¸¸æƒ…å†µæµ‹è¯•
  - [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯• (ç©ºå€¼ã€æå€¼ã€ç‰¹æ®Šå­—ç¬¦)
  - [ ] å¼‚å¸¸æƒ…å†µæµ‹è¯• (é”™è¯¯è¾“å…¥ã€ç½‘ç»œæ•…éšœ)
  - [ ] å¹¶å‘åœºæ™¯æµ‹è¯• (å¦‚é€‚ç”¨)

æµ‹è¯•ç»“æ„:
  - [ ] ä½¿ç”¨ Arrange-Act-Assert ï¿½ï¿½ï¿½å¼
  - [ ] æµ‹è¯•æœ‰æ¸…æ™°çš„æè¿°
  - [ ] æµ‹è¯•ç‹¬ç«‹ (ä¸ä¾èµ–å…¶ä»–æµ‹è¯•)
  - [ ] æµ‹è¯•å¯é‡å¤ (å¹‚ç­‰æ€§)

Mock ä½¿ç”¨:
  - [ ] å¤–éƒ¨æœåŠ¡ä½¿ç”¨ Mock (æ•°æ®åº“ã€APIã€æ–‡ä»¶ç³»ç»Ÿ)
  - [ ] æ—¶é—´æ•æ„Ÿæµ‹è¯•ä½¿ç”¨ Mock (datetime.now)
  - [ ] éšæœºæ•°æµ‹è¯•ä½¿ç”¨ Mock (random.random)
  - [ ] Mock æœ‰æ¸…æ™°çš„æ–­è¨€
```

---

### 5.2 é›†æˆæµ‹è¯•è¦æ±‚

**API é›†æˆæµ‹è¯• (pytest + httpx)**:

```python
# tests/integration/test_user_api.py
import pytest
from httpx import AsyncClient
from app.main import app

@pytest.mark.asyncio
async def test_create_user_success():
    """æµ‹è¯•åˆ›å»ºç”¨æˆ·æˆåŠŸ"""
    async with AsyncClient(app=app, base_url="http://test") as client:
        response = await client.post("/api/v1/users", json={
            "email": "test@example.com",
            "password": "Test1234",
            "username": "testuser"
        })

        assert response.status_code == 201
        data = response.json()
        assert data["email"] == "test@example.com"
        assert data["username"] == "testuser"
        assert "password" not in data  # å¯†ç ä¸åº”è¿”å›
        assert "id" in data
        assert "created_at" in data

@pytest.mark.asyncio
async def test_create_user_duplicate_email_fails():
    """æµ‹è¯•åˆ›å»ºé‡å¤é‚®ç®±çš„ç”¨æˆ·å¤±è´¥"""
    async with AsyncClient(app=app, base_url="http://test") as client:
        # åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·
        await client.post("/api/v1/users", json={
            "email": "test@example.com",
            "password": "Test1234",
            "username": "testuser1"
        })

        # å°è¯•åˆ›å»ºé‡å¤é‚®ç®±çš„ç”¨æˆ·
        response = await client.post("/api/v1/users", json={
            "email": "test@example.com",
            "password": "Test5678",
            "username": "testuser2"
        })

        assert response.status_code == 400
        assert "already exists" in response.json()["detail"]

@pytest.mark.asyncio
async def test_login_success():
    """æµ‹è¯•ç™»å½•æˆåŠŸ"""
    async with AsyncClient(app=app, base_url="http://test") as client:
        # åˆ›å»ºç”¨æˆ·
        await client.post("/api/v1/users", json={
            "email": "test@example.com",
            "password": "Test1234",
            "username": "testuser"
        })

        # ç™»å½•
        response = await client.post("/api/v1/auth/login", json={
            "email": "test@example.com",
            "password": "Test1234"
        })

        assert response.status_code == 200
        data = response.json()
        assert "access_token" in data
        assert "refresh_token" in data
        assert data["token_type"] == "bearer"

@pytest.mark.asyncio
async def test_get_current_user_requires_authentication():
    """æµ‹è¯•è·å–å½“å‰ç”¨æˆ·éœ€è¦è®¤è¯"""
    async with AsyncClient(app=app, base_url="http://test") as client:
        # æœªè®¤è¯è¯·æ±‚
        response = await client.get("/api/v1/users/me")

        assert response.status_code == 401
        assert "Not authenticated" in response.json()["detail"]
```

**é›†æˆæµ‹è¯•æ£€æŸ¥æ¸…å•**:

```yaml
API ç«¯ç‚¹æµ‹è¯•:
  - [ ] æµ‹è¯•å®Œæ•´çš„ CRUD æ“ä½œ
  - [ ] æµ‹è¯•è®¤è¯å’Œæˆæƒé€»è¾‘
  - [ ] æµ‹è¯•è¯·æ±‚å‚æ•°éªŒè¯
  - [ ] æµ‹è¯•é”™è¯¯å“åº”æ ¼å¼

æ•°æ®åº“é›†æˆæµ‹è¯•:
  - [ ] ä½¿ç”¨äº‹åŠ¡å›æ»š (ä¸æ±¡æŸ“æµ‹è¯•ç¯å¢ƒ)
  - [ ] æµ‹è¯•æ•°æ®å®Œæ•´æ€§çº¦æŸ
  - [ ] æµ‹è¯•ç´¢å¼•å’ŒæŸ¥è¯¢æ€§èƒ½
  - [ ] æµ‹è¯•å¹¶å‘åœºæ™¯ (å¦‚é€‚ç”¨)

å¤–éƒ¨æœåŠ¡ Mock:
  - [ ] S3 ä¸Šä¼ ä½¿ç”¨ Mock
  - [ ] é‚®ä»¶æœåŠ¡ä½¿ç”¨ Mock
  - [ ] AI æ¨¡å‹æœåŠ¡ä½¿ç”¨ Mock
  - [ ] æ”¯ä»˜ç½‘å…³ä½¿ç”¨ Mock
```

---

### 5.3 E2E æµ‹è¯•è¦æ±‚

**Playwright E2E æµ‹è¯•**:

```typescript
// tests/e2e/login.spec.ts
import { test, expect } from '@playwright/test'

test('user can login successfully', async ({ page }) => {
  // è®¿é—®ç™»å½•é¡µ
  await page.goto('http://localhost:5173/login')

  // å¡«å†™è¡¨å•
  await page.fill('[data-testid="email-input"]', 'test@example.com')
  await page.fill('[data-testid="password-input"]', 'Test1234')
  await page.click('[data-testid="login-btn"]')

  // éªŒè¯è·³è½¬åˆ°ä»ªè¡¨æ¿
  await expect(page).toHaveURL('http://localhost:5173/dashboard')

  // éªŒè¯ç”¨æˆ·èœå•å¯è§
  await expect(page.locator('[data-testid="user-menu"]')).toBeVisible()
})

test('login fails with invalid credentials', async ({ page }) => {
  await page.goto('http://localhost:5173/login')

  await page.fill('[data-testid="email-input"]', 'wrong@example.com')
  await page.fill('[data-testid="password-input"]', 'wrongpass')
  await page.click('[data-testid="login-btn"]')

  // éªŒè¯é”™è¯¯æç¤º
  await expect(page.locator('[data-testid="error-message"]')).toContainText('Invalid credentials')

  // éªŒè¯ä»åœ¨ç™»å½•é¡µ
  await expect(page).toHaveURL('http://localhost:5173/login')
})

test('complete user journey: login â†’ create project â†’ edit â†’ export', async ({ page }) => {
  // 1. ç™»å½•
  await page.goto('http://localhost:5173/login')
  await page.fill('[data-testid="email-input"]', 'test@example.com')
  await page.fill('[data-testid="password-input"]', 'Test1234')
  await page.click('[data-testid="login-btn"]')
  await expect(page).toHaveURL('http://localhost:5173/dashboard')

  // 2. åˆ›å»ºé¡¹ç›®
  await page.click('[data-testid="create-project-btn"]')
  await page.fill('[data-testid="project-title"]', 'E2E Test Project')
  await page.click('[data-testid="confirm-create-btn"]')
  await expect(page.locator('[data-testid="project-card"]')).toContainText('E2E Test Project')

  // 3. è¿›å…¥ç¼–è¾‘å™¨
  await page.click('[data-testid="project-card"]:has-text("E2E Test Project")')
  await expect(page).toHaveURL(/\/editor\//)

  // 4. ç¼–è¾‘è®¾è®¡
  await page.fill('[data-testid="title-input"]', 'åŒ11å¤§ä¿ƒ')
  await page.fill('[data-testid="content-input"]', 'å…¨åœº5æŠ˜èµ·')
  await page.click('[data-testid="generate-btn"]')

  // ç­‰å¾…ç”Ÿæˆå®Œæˆ
  await expect(page.locator('[data-testid="design-variants"]')).toBeVisible({ timeout: 15000 })

  // 5. å¯¼å‡º
  await page.click('[data-testid="design-variant"]:first-child')
  await page.click('[data-testid="export-btn"]')
  await page.selectOption('[data-testid="format-select"]', 'png')
  await page.click('[data-testid="confirm-export-btn"]')

  // éªŒè¯å¯¼å‡ºæˆåŠŸ
  await expect(page.locator('[data-testid="export-success-message"]')).toBeVisible({ timeout: 30000 })
})
```

**E2E æµ‹è¯•æ£€æŸ¥æ¸…å•**:

```yaml
æ ¸å¿ƒç”¨æˆ·æµç¨‹:
  - [ ] ç”¨æˆ·æ³¨å†Œæµç¨‹
  - [ ] ç”¨æˆ·ç™»å½•æµç¨‹
  - [ ] åˆ›å»ºé¡¹ç›®æµç¨‹
  - [ ] ç¼–è¾‘å’Œç”Ÿæˆè®¾è®¡æµç¨‹
  - [ ] å¯¼å‡ºæµç¨‹
  - [ ] åˆ é™¤é¡¹ç›®æµç¨‹

é”™è¯¯æ¢å¤æµç¨‹:
  - [ ] ç½‘ç»œé”™è¯¯æç¤ºå’Œé‡è¯•
  - [ ] è¡¨å•éªŒè¯é”™è¯¯æç¤º
  - [ ] æƒé™ä¸è¶³é”™è¯¯æç¤º
  - [ ] è¶…æ—¶é”™è¯¯å¤„ç†

è·¨æµè§ˆå™¨å…¼å®¹æ€§:
  - [ ] Chrome (æœ€æ–°ç‰ˆ)
  - [ ] Firefox (æœ€æ–°ç‰ˆ)
  - [ ] Safari (æœ€æ–°ç‰ˆ)
  - [ ] Edge (æœ€æ–°ç‰ˆ)

å“åº”å¼å¸ƒå±€:
  - [ ] Desktop (1920x1080)
  - [ ] Laptop (1366x768)
  - [ ] Tablet (768x1024)
  - [ ] Mobile (375x667)
```

---

## éƒ¨ç½²å’Œå‘å¸ƒæ ‡å‡†

### 6.1 éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

**ä»£ç è´¨é‡æ£€æŸ¥**:

```yaml
ä»£ç å®¡æŸ¥:
  - [ ] Pull Request å·²é€šè¿‡ (è‡³å°‘ 1 äºº Approve)
  - [ ] æ‰€æœ‰ CI æ£€æŸ¥é€šè¿‡ (Lint + Test + Build)
  - [ ] æ— æœªè§£å†³çš„ Code Review è¯„è®º
  - [ ] æ—  TODO/FIXME/HACK æ³¨é‡Š

æµ‹è¯•æ£€æŸ¥:
  - [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ ç›®æ ‡å€¼
  - [ ] é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - [ ] E2E æµ‹è¯•å…¨éƒ¨é€šè¿‡
  - [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ (å¦‚é€‚ç”¨)
  - [ ] å®‰å…¨æ‰«æé€šè¿‡

æ–‡æ¡£æ£€æŸ¥:
  - [ ] API æ–‡æ¡£æ›´æ–°
  - [ ] æ•°æ®åº“è¿ç§»è„šæœ¬å·²åˆ›å»º
  - [ ] README æ›´æ–° (å¦‚æœ‰æ–°ä¾èµ–æˆ–ç¯å¢ƒå˜é‡)
  - [ ] CHANGELOG æ›´æ–°
```

**ç¯å¢ƒé…ç½®æ£€æŸ¥**:

```yaml
æµ‹è¯•ç¯å¢ƒ (Staging):
  - [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
  - [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
  - [ ] Redis è¿æ¥æ­£å¸¸
  - [ ] RabbitMQ è¿æ¥æ­£å¸¸
  - [ ] S3 å­˜å‚¨é…ç½®æ­£ç¡®
  - [ ] ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®æ­£ç¡® (SendGrid, Stripe)

ç”Ÿäº§ç¯å¢ƒ (Production):
  - [ ] æ‰€æœ‰é…ç½®æ£€æŸ¥ (åŒæµ‹è¯•ç¯å¢ƒ)
  - [ ] ç›‘æ§å‘Šè­¦å·²é…ç½® (Prometheus + Grafana)
  - [ ] æ—¥å¿—èšåˆå·²é…ç½® (ELK Stack)
  - [ ] å¤‡ä»½ç­–ç•¥å·²é…ç½® (æ—¥å¤‡ä»½ + è·¨åœ°åŸŸ)
  - [ ] SSL è¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥
```

---

### 6.2 ç°åº¦å‘å¸ƒç­–ç•¥

**ç°åº¦å‘å¸ƒæµç¨‹**:

```yaml
ç¬¬ä¸€é˜¶æ®µ (5% æµé‡):
  æ—¶é—´: 1 å°æ—¶
  ç›‘æ§æŒ‡æ ‡:
    - é”™è¯¯ç‡ < 0.1%
    - P95 å“åº”æ—¶é—´ < ç›®æ ‡å€¼
    - CPU ä½¿ç”¨ç‡ < 70%
    - å†…å­˜ä½¿ç”¨ç‡ < 80%

  å¦‚æœå¼‚å¸¸:
    - ç«‹å³å›æ»š
    - è®°å½•é—®é¢˜
    - ä¿®å¤åé‡æ–°éƒ¨ç½²

ç¬¬äºŒé˜¶æ®µ (50% æµé‡):
  æ—¶é—´: 4 å°æ—¶
  ç›‘æ§æŒ‡æ ‡: (åŒç¬¬ä¸€é˜¶æ®µ)

  å¦‚æœæ­£å¸¸:
    - ç»§ç»­è§‚å¯Ÿ
    - æ”¶é›†ç”¨æˆ·åé¦ˆ

  å¦‚æœå¼‚å¸¸:
    - ç«‹å³å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
    - åˆ†æé—®é¢˜æ ¹å› 

ç¬¬ä¸‰é˜¶æ®µ (100% æµé‡):
  æ—¶é—´: 24 å°æ—¶
  ç›‘æ§æŒ‡æ ‡: (åŒç¬¬ä¸€é˜¶æ®µ)

  å¦‚æœæ­£å¸¸:
    - å‘å¸ƒæˆåŠŸ
    - è®°å½•å‘å¸ƒæ—¥å¿—
    - é€šçŸ¥ç›¸å…³äººå‘˜

  å¦‚æœå¼‚å¸¸:
    - ç«‹å³å›æ»š
    - Post-Mortem åˆ†æ
```

**Kubernetes ç°åº¦å‘å¸ƒé…ç½®**:

```yaml
# backend/k8s/canary-deployment.yaml
apiVersion: v1
kind: Service
metadata:
  name: user-service
spec:
  selector:
    app: user-service
  ports:
    - port: 3001
      targetPort: 3001

---
# ç¨³å®šç‰ˆæœ¬ (95% æµé‡)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service-stable
spec:
  replicas: 19  # 95% æµé‡
  selector:
    matchLabels:
      app: user-service
      version: stable
  template:
    metadata:
      labels:
        app: user-service
        version: stable
    spec:
      containers:
      - name: user-service
        image: registry.example.com/user-service:v1.2.3
        ports:
        - containerPort: 3001

---
# é‡‘ä¸é›€ç‰ˆæœ¬ (5% æµé‡)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service-canary
spec:
  replicas: 1  # 5% æµé‡
  selector:
    matchLabels:
      app: user-service
      version: canary
  template:
    metadata:
      labels:
        app: user-service
        version: canary
    spec:
      containers:
      - name: user-service
        image: registry.example.com/user-service:v1.3.0
        ports:
        - containerPort: 3001
```

---

### 6.3 å›æ»šæµç¨‹

**å›æ»šå†³ç­–æ ‡å‡†**:

```yaml
ç«‹å³å›æ»šè§¦å‘æ¡ä»¶:
  - [ ] é”™è¯¯ç‡ > 1%
  - [ ] P95 å“åº”æ—¶é—´ > 2x åŸºçº¿
  - [ ] CPU ä½¿ç”¨ç‡ > 90%
  - [ ] å†…å­˜ä½¿ç”¨ç‡ > 95%
  - [ ] å…³é”®åŠŸèƒ½ä¸å¯ç”¨
  - [ ] æ•°æ®æŸåæˆ–ä¸¢å¤±

è€ƒè™‘å›æ»šè§¦å‘æ¡ä»¶:
  - [ ] é”™è¯¯ç‡ > 0.5%
  - [ ] P95 å“åº”æ—¶é—´ > 1.5x åŸºçº¿
  - [ ] ç”¨æˆ·æŠ•è¯‰æ¿€å¢
  - [ ] ä¸šåŠ¡æŒ‡æ ‡å¼‚å¸¸
```

**å›æ»šæ‰§è¡Œæ­¥éª¤**:

```bash
# 1. ç«‹å³åœæ­¢æ–°ç‰ˆæœ¬æµé‡ (è®¾ç½®ä¸º 0 å‰¯æœ¬)
kubectl scale deployment user-service-canary --replicas=0 -n production

# 2. å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/user-service -n production

# 3. éªŒè¯å›æ»šæˆåŠŸ
kubectl rollout status deployment/user-service -n production

# 4. æ•°æ®åº“å›æ»š (å¦‚æœ‰è¿ç§»)
cd backend/services/user-service
poetry run alembic downgrade -1

# 5. éªŒè¯æœåŠ¡å¥åº·
kubectl get pods -n production
curl http://api.example.com/health

# 6. ç›‘æ§å…³é”®æŒ‡æ ‡ (15 åˆ†é’Ÿ)
# - é”™è¯¯ç‡
# - å“åº”æ—¶é—´
# - CPU/å†…å­˜ä½¿ç”¨ç‡
# - ç”¨æˆ·è¯·æ±‚æˆåŠŸç‡

# 7. é€šçŸ¥ç›¸å…³äººå‘˜
# - å‘é€å›æ»šé€šçŸ¥
# - è®°å½•å›æ»šåŸå› 
# - å®‰æ’ Post-Mortem ä¼šè®®
```

**å›æ»šåæ“ä½œ**:

```yaml
Post-Mortem åˆ†æ:
  - [ ] è®°å½•å›æ»šæ—¶é—´å’ŒåŸå› 
  - [ ] åˆ†æé—®é¢˜æ ¹å› 
  - [ ] åˆ¶å®šä¿®å¤è®¡åˆ’
  - [ ] æ›´æ–°æµ‹è¯•ç”¨ä¾‹ (é˜²æ­¢å›å½’)
  - [ ] åˆ†äº«ç»éªŒæ•™è®­

ä»£ç ä¿®å¤:
  - [ ] ä¿®å¤é—®é¢˜ä»£ç 
  - [ ] è¡¥å……æµ‹è¯•ç”¨ä¾‹
  - [ ] ä»£ç å®¡æŸ¥
  - [ ] åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
  - [ ] é‡æ–°éƒ¨ç½²
```

---

## è´¨é‡é—¨ç¦æ£€æŸ¥æµç¨‹

### 7.1 Pull Request è´¨é‡é—¨ç¦

**å¿…é¡»é€šè¿‡çš„æ£€æŸ¥ (é˜»å¡åˆå¹¶)**:

```yaml
è‡ªåŠ¨åŒ–æ£€æŸ¥:
  - [ ] ESLint/Prettier æ£€æŸ¥é€šè¿‡ (å‰ç«¯)
  - [ ] Black/Ruff/mypy æ£€æŸ¥é€šè¿‡ (åç«¯)
  - [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80% (å‰ç«¯)ã€â‰¥ 85% (åç«¯)
  - [ ] é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - [ ] E2E æµ‹è¯•å…¨éƒ¨é€šè¿‡ (æ ¸å¿ƒæµç¨‹)
  - [ ] å®‰å…¨æ‰«æé€šè¿‡ (æ— é«˜å±æ¼æ´)
  - [ ] æ„å»ºæˆåŠŸ (npm run build / docker build)

äººå·¥å®¡æŸ¥:
  - [ ] è‡³å°‘ 1 äºº Approve
  - [ ] æ‰€æœ‰ Code Review è¯„è®ºå·²è§£å†³
  - [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
  - [ ] æ—  TODO/FIXME/HACK æ³¨é‡Š
  - [ ] æ–‡æ¡£å·²æ›´æ–° (API/README/CHANGELOG)
```

**GitLab CI é…ç½®ç¤ºä¾‹** (`.gitlab-ci.yml`):

```yaml
stages:
  - lint
  - test
  - build
  - quality-gate

# å‰ç«¯ Lint
frontend-lint:
  stage: lint
  image: node:20
  script:
    - cd frontend
    - npm install -g pnpm
    - pnpm install
    - pnpm lint
    - pnpm type-check
  only:
    changes:
      - frontend/**/*

# åç«¯ Lint
backend-lint:
  stage: lint
  image: python:3.11
  script:
    - cd backend/services/user-service
    - pip install poetry
    - poetry install
    - poetry run black --check app/
    - poetry run ruff check app/
    - poetry run mypy app/
  only:
    changes:
      - backend/**/*

# å‰ç«¯æµ‹è¯•
frontend-test:
  stage: test
  image: node:20
  script:
    - cd frontend
    - pnpm install
    - pnpm test:unit --coverage
  coverage: '/All files[^|]*\|[^|]*\s+([\d\.]+)/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: frontend/coverage/cobertura-coverage.xml

# åç«¯æµ‹è¯•
backend-test:
  stage: test
  image: python:3.11
  services:
    - postgres:14
    - redis:7
  variables:
    POSTGRES_DB: test_db
    POSTGRES_USER: test_user
    POSTGRES_PASSWORD: test_password
  script:
    - cd backend/services/user-service
    - poetry install
    - poetry run pytest tests/ --cov=app --cov-report=xml --cov-report=term
  coverage: '/TOTAL.*\s+(\d+%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: backend/services/user-service/coverage.xml

# å®‰å…¨æ‰«æ
security-scan:
  stage: quality-gate
  image: snyk/snyk:python-3.11
  script:
    - cd backend/services/user-service
    - snyk test --severity-threshold=high --json > snyk-report.json
  allow_failure: false
  artifacts:
    reports:
      dependency_scanning: snyk-report.json

# è´¨é‡é—¨ç¦æ£€æŸ¥
quality-gate:
  stage: quality-gate
  script:
    - echo "Checking quality gates..."
    - |
      if [ "$FRONTEND_COVERAGE" -lt 80 ]; then
        echo "Frontend coverage $FRONTEND_COVERAGE% is below 80%"
        exit 1
      fi
    - |
      if [ "$BACKEND_COVERAGE" -lt 85 ]; then
        echo "Backend coverage $BACKEND_COVERAGE% is below 85%"
        exit 1
      fi
    - echo "All quality gates passed!"
  dependencies:
    - frontend-test
    - backend-test
    - security-scan
```

---

### 7.2 æµ‹è¯•ç¯å¢ƒéƒ¨ç½²è´¨é‡é—¨ç¦

**éƒ¨ç½²å‰æ£€æŸ¥**:

```yaml
ä»£ç è´¨é‡:
  - [ ] Pull Request å·²åˆå¹¶åˆ° develop åˆ†æ”¯
  - [ ] æ‰€æœ‰ CI æ£€æŸ¥é€šè¿‡
  - [ ] ä»£ç å®¡æŸ¥å®Œæˆ

ç¯å¢ƒå‡†å¤‡:
  - [ ] æµ‹è¯•ç¯å¢ƒå¯ç”¨
  - [ ] æ•°æ®åº“è¿ç§»è„šæœ¬å·²å‡†å¤‡
  - [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
  - [ ] ä¾èµ–æœåŠ¡æ­£å¸¸ (PostgreSQL/Redis/RabbitMQ)

æ•°æ®åº“è¿ç§»:
  - [ ] è¿ç§»è„šæœ¬åœ¨æœ¬åœ°éªŒè¯æˆåŠŸ
  - [ ] è¿ç§»è„šæœ¬æœ‰å›æ»šæ–¹æ³• (downgrade)
  - [ ] æ•°æ®åº“å¤‡ä»½å®Œæˆ
```

**éƒ¨ç½²åéªŒè¯**:

```yaml
æœåŠ¡å¥åº·æ£€æŸ¥:
  - [ ] æ‰€æœ‰ Pod çŠ¶æ€ä¸º Running
  - [ ] Liveness Probe æ£€æŸ¥é€šè¿‡
  - [ ] Readiness Probe æ£€æŸ¥é€šè¿‡
  - [ ] æœåŠ¡ç«¯å£æ­£å¸¸ç›‘å¬

åŠŸèƒ½éªŒè¯:
  - [ ] API å¥åº·æ£€æŸ¥ç«¯ç‚¹è¿”å› 200
  - [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
  - [ ] Redis è¿æ¥æ­£å¸¸
  - [ ] RabbitMQ è¿æ¥æ­£å¸¸
  - [ ] S3 å­˜å‚¨å¯è®¿é—®

çƒŸé›¾æµ‹è¯•:
  - [ ] ç”¨æˆ·ç™»å½•æˆåŠŸ
  - [ ] åˆ›å»ºé¡¹ç›®æˆåŠŸ
  - [ ] ç”Ÿæˆè®¾è®¡æˆåŠŸ (è°ƒç”¨ AI æœåŠ¡)
  - [ ] å¯¼å‡ºæˆåŠŸ (è°ƒç”¨å¯¼å‡ºæœåŠ¡)
```

**éªŒè¯è„šæœ¬ç¤ºä¾‹**:

```bash
#!/bin/bash
# scripts/verify-deployment.sh

set -e

echo "ğŸ” Verifying deployment..."

# 1. æ£€æŸ¥ Pod çŠ¶æ€
echo "Checking Pod status..."
kubectl get pods -n staging | grep user-service | grep Running
echo "âœ… Pod status OK"

# 2. æ£€æŸ¥å¥åº·ç«¯ç‚¹
echo "Checking health endpoint..."
HEALTH_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://staging.example.com/api/v1/health)
if [ "$HEALTH_STATUS" -eq 200 ]; then
  echo "âœ… Health endpoint OK"
else
  echo "âŒ Health endpoint failed: $HEALTH_STATUS"
  exit 1
fi

# 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
echo "Checking database connection..."
DB_STATUS=$(curl -s http://staging.example.com/api/v1/health | jq -r '.database')
if [ "$DB_STATUS" == "ok" ]; then
  echo "âœ… Database connection OK"
else
  echo "âŒ Database connection failed"
  exit 1
fi

# 4. è¿è¡ŒçƒŸé›¾æµ‹è¯•
echo "Running smoke tests..."
pytest tests/smoke/ --base-url=http://staging.example.com
echo "âœ… Smoke tests passed"

echo "ğŸ‰ Deployment verification completed successfully!"
```

---

### 7.3 ç”Ÿäº§ç¯å¢ƒå‘å¸ƒè´¨é‡é—¨ç¦

**å‘å¸ƒå‰æ£€æŸ¥** (å¿…é¡»å…¨éƒ¨é€šè¿‡):

```yaml
ä»£ç è´¨é‡:
  - [ ] Pull Request å·²åˆå¹¶åˆ° main åˆ†æ”¯
  - [ ] æ‰€æœ‰ CI æ£€æŸ¥é€šè¿‡
  - [ ] ä»£ç å®¡æŸ¥å®Œæˆ (è‡³å°‘ 2 äºº Approve)
  - [ ] æ— é«˜å±æˆ–ä¸­å±å®‰å…¨æ¼æ´

æµ‹è¯•éªŒè¯:
  - [ ] æµ‹è¯•ç¯å¢ƒéƒ¨ç½²æˆåŠŸ
  - [ ] é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - [ ] E2E æµ‹è¯•å…¨éƒ¨é€šè¿‡
  - [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ (P95 < ç›®æ ‡å€¼)
  - [ ] å®‰å…¨æµ‹è¯•é€šè¿‡

æ–‡æ¡£å‡†å¤‡:
  - [ ] å‘å¸ƒè¯´æ˜å·²ç¼–å†™ (Release Notes)
  - [ ] CHANGELOG æ›´æ–°
  - [ ] æ•°æ®åº“è¿ç§»æ–‡æ¡£
  - [ ] å›æ»šè®¡åˆ’å·²å‡†å¤‡

è¿ç»´å‡†å¤‡:
  - [ ] ç”Ÿäº§ç¯å¢ƒå¤‡ä»½å®Œæˆ
  - [ ] ç›‘æ§å‘Šè­¦å·²é…ç½®
  - [ ] æ—¥å¿—èšåˆæ­£å¸¸
  - [ ] å›æ»šè„šæœ¬å·²æµ‹è¯•
  - [ ] è¿ç»´å›¢é˜Ÿå·²é€šçŸ¥
```

**å‘å¸ƒæ‰§è¡Œæ£€æŸ¥**:

```yaml
ç°åº¦å‘å¸ƒ (5% æµé‡):
  - [ ] é‡‘ä¸é›€ç‰ˆæœ¬éƒ¨ç½²æˆåŠŸ
  - [ ] å¥åº·æ£€æŸ¥é€šè¿‡
  - [ ] é”™è¯¯ç‡ < 0.1%
  - [ ] P95 å“åº”æ—¶é—´ < ç›®æ ‡å€¼
  - [ ] è§‚å¯Ÿ 1 å°æ—¶æ— å¼‚å¸¸

æ‰©å¤§å‘å¸ƒ (50% æµé‡):
  - [ ] æµé‡åˆ‡æ¢æˆåŠŸ
  - [ ] é”™è¯¯ç‡ < 0.1%
  - [ ] P95 å“åº”æ—¶é—´ < ç›®æ ‡å€¼
  - [ ] ç”¨æˆ·åé¦ˆæ­£å¸¸
  - [ ] è§‚å¯Ÿ 4 å°æ—¶æ— å¼‚å¸¸

å…¨é‡å‘å¸ƒ (100% æµé‡):
  - [ ] æµé‡åˆ‡æ¢æˆåŠŸ
  - [ ] é”™è¯¯ç‡ < 0.1%
  - [ ] P95 å“åº”æ—¶é—´ < ç›®æ ‡å€¼
  - [ ] ä¸šåŠ¡æŒ‡æ ‡æ­£å¸¸
  - [ ] è§‚å¯Ÿ 24 å°æ—¶æ— å¼‚å¸¸
```

**å‘å¸ƒåéªŒè¯**:

```yaml
åŠŸèƒ½éªŒè¯:
  - [ ] æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨æ­£å¸¸
  - [ ] æ–°åŠŸèƒ½æŒ‰é¢„æœŸå·¥ä½œ
  - [ ] æ•°æ®åº“è¿ç§»æˆåŠŸ
  - [ ] ç¬¬ä¸‰æ–¹é›†æˆæ­£å¸¸

ç›‘æ§éªŒè¯:
  - [ ] é”™è¯¯ç‡ < åŸºçº¿
  - [ ] å“åº”æ—¶é—´ < åŸºçº¿
  - [ ] CPU ä½¿ç”¨ç‡æ­£å¸¸
  - [ ] å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸
  - [ ] ç£ç›˜ä½¿ç”¨ç‡æ­£å¸¸

ä¸šåŠ¡éªŒè¯:
  - [ ] ç”¨æˆ·æ³¨å†Œæ­£å¸¸
  - [ ] ç”¨æˆ·ç™»å½•æ­£å¸¸
  - [ ] é¡¹ç›®åˆ›å»ºæ­£å¸¸
  - [ ] è®¾è®¡ç”Ÿæˆæ­£å¸¸
  - [ ] å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
  - [ ] æ”¯ä»˜åŠŸèƒ½æ­£å¸¸ (å¦‚æ¶‰åŠ)
```

---

## æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº† AI PosterGen é¡¹ç›®çš„å®Œæ•´äº¤ä»˜æ ‡å‡†å’Œè´¨é‡é—¨ç¦ä½“ç³»,åŒ…æ‹¬:

âœ… **åŠŸèƒ½å®Œæˆæ ‡å‡†** (Definition of Done) - ä»£ç ã€æµ‹è¯•ã€æ–‡æ¡£ã€æ€§èƒ½ã€å®‰å…¨ã€éƒ¨ç½²å…¨é¢æ£€æŸ¥æ¸…å•
âœ… **ä»£ç è´¨é‡æ ‡å‡†** - å‰åç«¯ä»£ç è§„èŒƒã€Lint é…ç½®ã€æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
âœ… **æ€§èƒ½æ ‡å‡†** - API å“åº”æ—¶é—´ã€å‰ç«¯ Core Web Vitalsã€æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
âœ… **å®‰å…¨æ ‡å‡†** - è®¤è¯æˆæƒã€è¾“å…¥éªŒè¯ã€SQL æ³¨å…¥é˜²æŠ¤ã€XSS/CSRF é˜²æŠ¤ã€æ•æ„Ÿæ•°æ®å¤„ç†
âœ… **æµ‹è¯•äº¤ä»˜æ ‡å‡†** - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€E2E æµ‹è¯•å®Œæ•´ç¤ºä¾‹å’Œæ£€æŸ¥æ¸…å•
âœ… **éƒ¨ç½²å’Œå‘å¸ƒæ ‡å‡†** - éƒ¨ç½²å‰æ£€æŸ¥ã€ç°åº¦å‘å¸ƒã€å›æ»šæµç¨‹
âœ… **è´¨é‡é—¨ç¦æµç¨‹** - PR è´¨é‡é—¨ç¦ã€æµ‹è¯•ç¯å¢ƒéƒ¨ç½²é—¨ç¦ã€ç”Ÿäº§ç¯å¢ƒå‘å¸ƒé—¨ç¦

**æ ¸å¿ƒåŸåˆ™**:
- è´¨é‡ç¬¬ä¸€,å®‰å…¨ä¸å¯å¦¥å
- è‡ªåŠ¨åŒ–æ£€æŸ¥,äººå·¥å®¡æŸ¥è¡¥å……
- æŒç»­ç›‘æ§,åŠæ—¶åé¦ˆ
- å¿«é€Ÿå›æ»š,é™ä½é£é™©

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. é…ç½® CI/CD æµæ°´çº¿ (GitLab CI / GitHub Actions)
2. è®¾ç½®è´¨é‡é—¨ç¦æ£€æŸ¥ (Coverage/Security/Performance)
3. åŸ¹è®­å›¢é˜Ÿæˆå‘˜ (è´¨é‡æ ‡å‡†å’Œæµç¨‹)
4. å®šæœŸå®¡æŸ¥å’Œä¼˜åŒ– (æ¯ä¸ª Sprint ç»“æŸå)

---

**æ–‡æ¡£ç»´æŠ¤**:
- ç‰ˆæœ¬: V1.0
- åˆ›å»º: 2025å¹´10æœˆ26æ—¥
- æ›´æ–°é¢‘ç‡: æ¯æœˆæˆ–é‡å¤§å˜æ›´æ—¶
- ç»´æŠ¤äºº: è´¨é‡å·¥ç¨‹å¸ˆ / æŠ€æœ¯ä¸»ç®¡
